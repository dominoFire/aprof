package aprofplot.gui;

import aprofplot.*;
import java.awt.Color;
import java.awt.Component;
import javax.swing.*;
import javax.swing.table.TableModel;
import javax.swing.text.BadLocationException;
import javax.swing.tree.*;
import java.util.*;
import java.io.*;
import javax.swing.filechooser.FileNameExtensionFilter;
import javax.swing.table.TableCellRenderer;
import javax.swing.table.TableRowSorter;
import org.fife.ui.rsyntaxtextarea.RSyntaxTextArea;
import org.fife.ui.rsyntaxtextarea.SyntaxConstants;
import org.fife.ui.rtextarea.RTextScrollPane;

public class MainWindow extends javax.swing.JFrame {

	private Routine rtn_info = null;
	private int graph_visible = 0;
	
	// add graph at the end of the list or wrt the "priority" order
	boolean append_graph = false;
	
	// Perfomance monitor
	PerformanceMonitor perf = new PerformanceMonitor();
	
	// Used for adapt correctly layout
	private JPanel fake = null;
	private JPanel fake2 = null;
	
	// Are we loading a new report?
	private boolean loading = false;
    
    // are we a routine with context with a click mouse event?
    private boolean loading_routine = false;
	
	// Is the editor visible ?
	private boolean editor_visible = false;
	
	// source code directory
	private String source_dir = null; 
	
	// Symbol table
	private HashMap<String, Symbol> sym = null;

	// source directory files
	private ArrayList<String> files = null;
	
	// index search function source code
	private int source_index = 0;
	
	// load function code of the selected entry in routine table in the editor?
	private boolean linked_editor = true;
	
	/** Creates new form MainWindow */
	public MainWindow() {
		
		try {
			
			javax.swing.UIManager.setLookAndFeel(javax.swing.UIManager.getSystemLookAndFeelClassName());
			initComponents();
			setExtendedState(MAXIMIZED_BOTH);
			initGraph();
			refreshRecentFiles();
			resetRoutineTableFilter();
            resetContextsTableFilter();
			checkEditor();
		
		} catch (Exception e) {
		
			System.out.println("Fatal error during start of MainWindow [1]");
			e.printStackTrace();
			System.exit(1);
		
		}
	
	}

	/** This method is called from within the constructor to
	 * initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is
	 * always regenerated by the Form Editor.
	 */
	@SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jButton5 = new javax.swing.JButton();
        jButton4 = new javax.swing.JButton();
        jPopupMenu1 = new javax.swing.JPopupMenu();
        jCheckBoxMenuItem4 = new javax.swing.JCheckBoxMenuItem();
        jCheckBoxMenuItem7 = new javax.swing.JCheckBoxMenuItem();
        jCheckBoxMenuItem10 = new javax.swing.JCheckBoxMenuItem();
        jCheckBoxMenuItem5 = new javax.swing.JCheckBoxMenuItem();
        jCheckBoxMenuItem6 = new javax.swing.JCheckBoxMenuItem();
        jCheckBoxMenuItem9 = new javax.swing.JCheckBoxMenuItem();
        jCheckBoxMenuItem8 = new javax.swing.JCheckBoxMenuItem();
        jCheckBoxMenuItem25 = new javax.swing.JCheckBoxMenuItem();
        jButton12 = new javax.swing.JButton();
        jToolBar1 = new javax.swing.JToolBar();
        jButton3 = new javax.swing.JButton();
        jButton1 = new javax.swing.JButton();
        jButton7 = new javax.swing.JButton();
        jButton10 = new javax.swing.JButton();
        jButton9 = new javax.swing.JButton();
        jSeparator2 = new javax.swing.JToolBar.Separator();
        jButton6 = new javax.swing.JButton();
        jSeparator5 = new javax.swing.JToolBar.Separator();
        jToggleButton10 = new javax.swing.JToggleButton();
        jToggleButton1 = new javax.swing.JToggleButton();
        jToggleButton4 = new javax.swing.JToggleButton();
        jSeparator3 = new javax.swing.JToolBar.Separator();
        jButton8 = new javax.swing.JButton();
        jSeparator6 = new javax.swing.JToolBar.Separator();
        jTextField1 = new javax.swing.JTextField();
        jButton2 = new javax.swing.JButton();
        jSeparator7 = new javax.swing.JToolBar.Separator();
        jLabel7 = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        jLabel9 = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        jProgressBar1 = new javax.swing.JProgressBar();
        jPanel2 = new javax.swing.JPanel();
        jSplitPane1 = new javax.swing.JSplitPane();
        jPanel3 = new javax.swing.JPanel();
        jSplitPane4 = new javax.swing.JSplitPane();
        jScrollPane5 = new javax.swing.JScrollPane();
        jPanel9 = new javax.swing.JPanel();
        jPanel11 = new javax.swing.JPanel();
        jToolBar2 = new javax.swing.JToolBar();
        jSeparator9 = new javax.swing.JToolBar.Separator();
        jToggleButton2 = new javax.swing.JToggleButton();
        jSeparator11 = new javax.swing.JToolBar.Separator();
        jTextField2 = new javax.swing.JTextField();
        jButton11 = new javax.swing.JButton();
        jSeparator8 = new javax.swing.JToolBar.Separator();
        jComboBox1 = new javax.swing.JComboBox<String>();
        jSeparator10 = new javax.swing.JToolBar.Separator();
        jSplitPane2 = new javax.swing.JSplitPane();
        jPanel6 = new javax.swing.JPanel();
        jLabel3 = new javax.swing.JLabel();
        jSplitPane5 = new javax.swing.JSplitPane();
        jScrollPane6 = new javax.swing.JScrollPane();
        jTable3 = new JTable(new RoutinesTableModel(this.report, this, false)) {
            public Component prepareRenderer(TableCellRenderer renderer, int row, int column)
            {
                try {
                    if (renderer == null) {
                        System.out.println("Renderer is null");
                        return null;
                    }
                    Component c = super.prepareRenderer(renderer, row, column);
                    if (c != null && !c.getBackground().equals(getSelectionBackground())) {
                        c.setBackground(java.awt.Color.WHITE);
                    }
                    return c;
                } catch(NullPointerException e) {
                    System.out.println("row: " + row + " col: " + column);
                    return null;
                }
            }
        };
        jScrollPane1 = new javax.swing.JScrollPane();
        jTable1 = new JTable(new RoutinesTableModel(this.report, this, ((RoutinesTableModel)jTable3.getModel()))) {
            public Component prepareRenderer(TableCellRenderer renderer, int row, int column)
            {
                try {
                    if (renderer == null) {
                        System.out.println("Renderer is null");
                        return null;
                    }
                    Component c = super.prepareRenderer(renderer, row, column);
                    if (c != null && !c.getBackground().equals(getSelectionBackground())) {
                        c.setBackground(java.awt.Color.WHITE);
                    }
                    return c;
                } catch(NullPointerException e) {
                    System.out.println("row: " + row + " col: " + column);
                    return null;
                }
            }
        };
        jTabbedPane1 = new javax.swing.JTabbedPane();
        jSplitPane3 = new javax.swing.JSplitPane();
        jPanel4 = new javax.swing.JPanel();
        jScrollPane2 = new javax.swing.JScrollPane();
        jTable2 = new javax.swing.JTable();
        jPanel5 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        jScrollPane3 = new javax.swing.JScrollPane();
        jList1 = new javax.swing.JList();
        jPanel8 = new javax.swing.JPanel();
        jScrollPane4 = new javax.swing.JScrollPane();
        jTree1 = new javax.swing.JTree();
        jMenuBar1 = new javax.swing.JMenuBar();
        jMenu1 = new javax.swing.JMenu();
        jMenuItem1 = new javax.swing.JMenuItem();
        jSeparator1 = new javax.swing.JSeparator();
        jMenuItem5 = new javax.swing.JMenuItem();
        jMenuItem8 = new javax.swing.JMenuItem();
        jMenu5 = new javax.swing.JMenu();
        recentMenuItem1 = new javax.swing.JMenuItem();
        recentMenuItem2 = new javax.swing.JMenuItem();
        recentMenuItem3 = new javax.swing.JMenuItem();
        recentMenuItem4 = new javax.swing.JMenuItem();
        recentMenuItem5 = new javax.swing.JMenuItem();
        recentMenuItem6 = new javax.swing.JMenuItem();
        jMenuItem6 = new javax.swing.JMenuItem();
        jMenu6 = new javax.swing.JMenu();
        jMenuItem11 = new javax.swing.JMenuItem();
        jMenuItem12 = new javax.swing.JMenuItem();
        jMenuItem13 = new javax.swing.JMenuItem();
        jMenuItem14 = new javax.swing.JMenuItem();
        jMenuItem15 = new javax.swing.JMenuItem();
        jMenuItem16 = new javax.swing.JMenuItem();
        jMenuItem17 = new javax.swing.JMenuItem();
        jMenuItem19 = new javax.swing.JMenuItem();
        jMenuItem20 = new javax.swing.JMenuItem();
        jMenuItem18 = new javax.swing.JMenuItem();
        jMenuItem21 = new javax.swing.JMenuItem();
        jMenuItem7 = new javax.swing.JMenuItem();
        jSeparator4 = new javax.swing.JSeparator();
        jMenuItem2 = new javax.swing.JMenuItem();
        jMenu2 = new javax.swing.JMenu();
        jMenuItem4 = new javax.swing.JMenuItem();
        jMenu3 = new javax.swing.JMenu();
        jCheckBoxMenuItem12 = new javax.swing.JCheckBoxMenuItem();
        jCheckBoxMenuItem15 = new javax.swing.JCheckBoxMenuItem();
        jCheckBoxMenuItem18 = new javax.swing.JCheckBoxMenuItem();
        jCheckBoxMenuItem13 = new javax.swing.JCheckBoxMenuItem();
        jCheckBoxMenuItem14 = new javax.swing.JCheckBoxMenuItem();
        jCheckBoxMenuItem17 = new javax.swing.JCheckBoxMenuItem();
        jCheckBoxMenuItem16 = new javax.swing.JCheckBoxMenuItem();
        jCheckBoxMenuItem24 = new javax.swing.JCheckBoxMenuItem();
        jCheckBoxMenuItem1 = new javax.swing.JCheckBoxMenuItem();
        jMenu4 = new javax.swing.JMenu();
        jMenuItem3 = new javax.swing.JMenuItem();

        jButton5.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/Filter-icon.png"))); // NOI18N
        jButton5.setToolTipText("Filter routines");
        jButton5.setBorder(null);
        jButton5.setMaximumSize(new java.awt.Dimension(28, 28));
        jButton5.setMinimumSize(new java.awt.Dimension(28, 28));
        jButton5.setPreferredSize(new java.awt.Dimension(28, 28));
        jScrollPane1.setCorner(javax.swing.ScrollPaneConstants.UPPER_RIGHT_CORNER, jButton5);
        jButton5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton5ActionPerformed(evt);
            }
        });

        jButton4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/Filter-icon.png"))); // NOI18N
        jButton4.setToolTipText("Filter rms");
        jButton4.setBorder(null);
        jButton4.setMaximumSize(new java.awt.Dimension(28, 28));
        jButton4.setMinimumSize(new java.awt.Dimension(28, 28));
        jButton4.setPreferredSize(new java.awt.Dimension(28, 28));
        jScrollPane2.setCorner(javax.swing.ScrollPaneConstants.UPPER_RIGHT_CORNER, jButton4);
        jButton4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton4ActionPerformed(evt);
            }
        });

        jPopupMenu1.addPopupMenuListener(new javax.swing.event.PopupMenuListener() {
            public void popupMenuCanceled(javax.swing.event.PopupMenuEvent evt) {
            }
            public void popupMenuWillBecomeInvisible(javax.swing.event.PopupMenuEvent evt) {
                jPopupMenu1PopupMenuWillBecomeInvisible(evt);
            }
            public void popupMenuWillBecomeVisible(javax.swing.event.PopupMenuEvent evt) {
            }
        });

        jCheckBoxMenuItem4.setText("Cost plot");
        jCheckBoxMenuItem4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem4ActionPerformed(evt);
            }
        });
        jPopupMenu1.add(jCheckBoxMenuItem4);

        jCheckBoxMenuItem7.setText("Amortized cost plot");
        jCheckBoxMenuItem7.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem7ActionPerformed(evt);
            }
        });
        jPopupMenu1.add(jCheckBoxMenuItem7);

        jCheckBoxMenuItem10.setText("Rms frequency plot");
        jCheckBoxMenuItem10.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem10ActionPerformed(evt);
            }
        });
        jPopupMenu1.add(jCheckBoxMenuItem10);

        jCheckBoxMenuItem5.setText("Min/Avg/Max cost plot");
        jCheckBoxMenuItem5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem5ActionPerformed(evt);
            }
        });
        jPopupMenu1.add(jCheckBoxMenuItem5);

        jCheckBoxMenuItem6.setText("Total cost plot");
        jCheckBoxMenuItem6.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem6ActionPerformed(evt);
            }
        });
        jPopupMenu1.add(jCheckBoxMenuItem6);

        jCheckBoxMenuItem9.setText("Cost variance plot");
        jCheckBoxMenuItem9.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem9ActionPerformed(evt);
            }
        });
        jPopupMenu1.add(jCheckBoxMenuItem9);

        jCheckBoxMenuItem8.setText("Curve bounding plot");
        jCheckBoxMenuItem8.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem8ActionPerformed(evt);
            }
        });
        jPopupMenu1.add(jCheckBoxMenuItem8);

        jCheckBoxMenuItem25.setText("Alpha plot");
        jCheckBoxMenuItem25.setToolTipText("");
        jCheckBoxMenuItem25.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem25ActionPerformed(evt);
            }
        });
        jPopupMenu1.add(jCheckBoxMenuItem25);

        jButton12.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/Filter-icon.png"))); // NOI18N
        jButton12.setToolTipText("Filter routines");
        jButton12.setBorder(null);
        jButton12.setMaximumSize(new java.awt.Dimension(28, 28));
        jButton12.setMinimumSize(new java.awt.Dimension(28, 28));
        jButton12.setPreferredSize(new java.awt.Dimension(28, 28));
        jScrollPane6.setCorner(javax.swing.ScrollPaneConstants.UPPER_RIGHT_CORNER, jButton12);
        jButton12.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton12ActionPerformed(evt);
            }
        });

        setDefaultCloseOperation(javax.swing.WindowConstants.DO_NOTHING_ON_CLOSE);
        setTitle("aprof-plot");
        setIconImage((new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/App-icon.png"))).getImage());
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                formWindowClosing(evt);
            }
            public void windowOpened(java.awt.event.WindowEvent evt) {
                formWindowOpened(evt);
            }
        });

        jToolBar1.setFloatable(false);
        jToolBar1.setRollover(true);
        jToolBar1.setMargin(new java.awt.Insets(0, 3, 0, 0));

        jButton3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/NewWindow-icon.png"))); // NOI18N
        jButton3.setToolTipText("open a new window");
        jButton3.setBorder(null);
        jButton3.setFocusable(false);
        jButton3.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jButton3.setMinimumSize(new java.awt.Dimension(28, 28));
        jButton3.setPreferredSize(new java.awt.Dimension(28, 28));
        jButton3.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton3ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton3);

        jButton1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/Open-icon.png"))); // NOI18N
        jButton1.setToolTipText("open an Aprof report file");
        jButton1.setBorder(null);
        jButton1.setFocusable(false);
        jButton1.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jButton1.setMaximumSize(new java.awt.Dimension(28, 28));
        jButton1.setPreferredSize(new java.awt.Dimension(28, 28));
        jButton1.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton1);

        jButton7.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/Save-icon.png"))); // NOI18N
        jButton7.setToolTipText("save report changes");
        jButton7.setBorder(null);
        jButton7.setEnabled(false);
        jButton7.setFocusable(false);
        jButton7.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jButton7.setMaximumSize(new java.awt.Dimension(28, 28));
        jButton7.setMinimumSize(new java.awt.Dimension(28, 28));
        jButton7.setPreferredSize(new java.awt.Dimension(28, 28));
        jButton7.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton7.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton7ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton7);

        jButton10.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/fs-directory.png"))); // NOI18N
        jButton10.setToolTipText("Set source code directory");
        jButton10.setBorder(null);
        jButton10.setEnabled(false);
        jButton10.setFocusable(false);
        jButton10.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jButton10.setMaximumSize(new java.awt.Dimension(28, 28));
        jButton10.setMinimumSize(new java.awt.Dimension(28, 28));
        jButton10.setPreferredSize(new java.awt.Dimension(28, 28));
        jButton10.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton10.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton10ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton10);

        jButton9.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/refresh.png"))); // NOI18N
        jButton9.setToolTipText("Reload last recent report");
        jButton9.setBorder(null);
        jButton9.setEnabled(false);
        ArrayList<File> r = Main.getRecentFiles();
        if (r.size() > 0) {
            jButton9.setEnabled(true);
        }
        jButton9.setFocusable(false);
        jButton9.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jButton9.setMaximumSize(new java.awt.Dimension(28, 28));
        jButton9.setMinimumSize(new java.awt.Dimension(28, 28));
        jButton9.setPreferredSize(new java.awt.Dimension(28, 28));
        jButton9.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton9.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton9ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton9);
        jToolBar1.add(jSeparator2);

        jButton6.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/Merge-icon.png"))); // NOI18N
        jButton6.setToolTipText("merge two or more aprof report files");
        jButton6.setBorder(null);
        jButton6.setEnabled(false);
        jButton6.setFocusable(false);
        jButton6.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jButton6.setMaximumSize(new java.awt.Dimension(28, 28));
        jButton6.setMinimumSize(new java.awt.Dimension(28, 28));
        jButton6.setPreferredSize(new java.awt.Dimension(28, 28));
        jButton6.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton6.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton6ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton6);
        jToolBar1.add(jSeparator5);

        jToggleButton10.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/statistics.png"))); // NOI18N
        jToggleButton10.setToolTipText("Select graphs to be shown");
        jToggleButton10.setFocusable(false);
        jToggleButton10.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jToggleButton10.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jToggleButton10.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jToggleButton10ActionPerformed(evt);
            }
        });
        jToolBar1.add(jToggleButton10);

        jToggleButton1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/editor.png"))); // NOI18N
        jToggleButton1.setToolTipText("Show source code editor");
        jToggleButton1.setEnabled(false);
        jToggleButton1.setFocusable(false);
        jToggleButton1.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jToggleButton1.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jToggleButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jToggleButton1ActionPerformed(evt);
            }
        });
        jToolBar1.add(jToggleButton1);

        jToggleButton4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/Unlink-icon.png"))); // NOI18N
        jToggleButton4.setSelected(true);
        jToggleButton4.setToolTipText("link/unlink plots");
        jToggleButton4.setFocusable(false);
        jToggleButton4.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jToggleButton4.setRolloverIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/Unlink-icon.png"))); // NOI18N
        jToggleButton4.setRolloverSelectedIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/Link-icon.png"))); // NOI18N
        jToggleButton4.setSelectedIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/Link-icon.png"))); // NOI18N
        jToggleButton4.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jToggleButton4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jToggleButton4ActionPerformed(evt);
            }
        });
        jToolBar1.add(jToggleButton4);
        jToolBar1.add(jSeparator3);

        jButton8.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/Settings-icon.png"))); // NOI18N
        jButton8.setToolTipText("settings");
        jButton8.setBorder(null);
        jButton8.setFocusable(false);
        jButton8.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jButton8.setMaximumSize(new java.awt.Dimension(28, 28));
        jButton8.setMinimumSize(new java.awt.Dimension(28, 28));
        jButton8.setPreferredSize(new java.awt.Dimension(28, 28));
        jButton8.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton8.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton8ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton8);
        jToolBar1.add(jSeparator6);

        jTextField1.setMaximumSize(new java.awt.Dimension(150, 27));
        jTextField1.setMinimumSize(new java.awt.Dimension(100, 27));
        jTextField1.setPreferredSize(new java.awt.Dimension(150, 27));
        jTextField1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField1ActionPerformed(evt);
            }
        });
        //jToolBar1.add(javax.swing.Box.createHorizontalGlue());
        jToolBar1.add(jTextField1);

        jButton2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/Search-icon.png"))); // NOI18N
        jButton2.setToolTipText("find in routines");
        jButton2.setBorder(null);
        jButton2.setFocusable(false);
        jButton2.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jButton2.setMaximumSize(new java.awt.Dimension(28, 28));
        jButton2.setMinimumSize(new java.awt.Dimension(28, 28));
        jButton2.setPreferredSize(new java.awt.Dimension(28, 28));
        jButton2.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton2);
        jToolBar1.add(jSeparator7);

        jLabel7.setFont(new java.awt.Font("DejaVu Sans", 1, 13)); // NOI18N
        jToolBar1.add(jLabel7);

        getContentPane().add(jToolBar1, java.awt.BorderLayout.NORTH);

        jPanel1.setLayout(new java.awt.GridLayout(1, 0));

        jLabel1.setText(" Routines: 0 ");
        jLabel1.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel1.add(jLabel1);

        jLabel4.setText(" Contexts: 0 ");
        jLabel4.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel1.add(jLabel4);

        jLabel5.setText(" Total cost: 0 ");
        jLabel5.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel1.add(jLabel5);

        jLabel6.setText(" Total calls: 0 ");
        jLabel6.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel1.add(jLabel6);
        jPanel1.add(jLabel9);
        jPanel1.add(jLabel8);

        jProgressBar1.setBorder(javax.swing.BorderFactory.createEmptyBorder(1, 10, 1, 1));
        jProgressBar1.setBorderPainted(false);
        jProgressBar1.setEnabled(false);
        jProgressBar1.setIndeterminate(true);
        jProgressBar1.setMaximumSize(new java.awt.Dimension(150, 18));
        jProgressBar1.setVisible(false);
        jPanel1.add(jProgressBar1);

        getContentPane().add(jPanel1, java.awt.BorderLayout.SOUTH);

        jPanel2.setLayout(new java.awt.BorderLayout());

        jSplitPane1.setOrientation(javax.swing.JSplitPane.VERTICAL_SPLIT);
        jSplitPane1.setDividerLocation(0.8);
        jSplitPane1.addHierarchyBoundsListener(new java.awt.event.HierarchyBoundsListener() {
            public void ancestorMoved(java.awt.event.HierarchyEvent evt) {
            }
            public void ancestorResized(java.awt.event.HierarchyEvent evt) {
                jSplitPane1AncestorResized(evt);
            }
        });

        jPanel3.setLayout(new java.awt.BorderLayout());

        jSplitPane4.setDividerLocation(0.75);
        jSplitPane4.setDividerSize(0);

        jScrollPane5.setMinimumSize(new java.awt.Dimension(400, 300));

        jPanel9.setLayout(new java.awt.GridLayout(6, 1));
        jScrollPane5.setViewportView(jPanel9);

        jSplitPane4.setLeftComponent(jScrollPane5);

        jPanel11.setBackground(new java.awt.Color(38, 26, 14));
        jPanel11.setLayout(new javax.swing.BoxLayout(jPanel11, javax.swing.BoxLayout.Y_AXIS));

        jToolBar2.setBorder(javax.swing.BorderFactory.createEmptyBorder(1, 1, 1, 1));
        jToolBar2.setFloatable(false);
        jToolBar2.setRollover(true);
        jToolBar2.setMaximumSize(new java.awt.Dimension(32767, 30));
        jToolBar2.add(jSeparator9);

        jToggleButton2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/chain_pencil.png"))); // NOI18N
        jToggleButton2.setSelected(true);
        jToggleButton2.setToolTipText("Load the source of the function selected in the routine table");
        jToggleButton2.setEnabled(false);
        jToggleButton2.setFocusable(false);
        jToggleButton2.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jToggleButton2.setMaximumSize(new java.awt.Dimension(26, 26));
        jToggleButton2.setMinimumSize(new java.awt.Dimension(26, 26));
        jToggleButton2.setPreferredSize(new java.awt.Dimension(26, 26));
        jToggleButton2.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jToggleButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jToggleButton2ActionPerformed(evt);
            }
        });
        jToolBar2.add(jToggleButton2);
        jToolBar2.add(jSeparator11);

        jTextField2.setEnabled(false);
        jTextField2.setMaximumSize(new java.awt.Dimension(150, 26));
        jTextField2.setMinimumSize(new java.awt.Dimension(150, 26));
        jTextField2.setPreferredSize(new java.awt.Dimension(150, 26));
        jTextField2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField2ActionPerformed(evt);
            }
        });
        jToolBar2.add(jTextField2);

        jButton11.setIcon(new javax.swing.ImageIcon(getClass().getResource("/aprofplot/gui/resources/Search-icon.png"))); // NOI18N
        jButton11.setEnabled(false);
        jButton11.setFocusable(false);
        jButton11.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jButton11.setMargin(new java.awt.Insets(0, 2, 0, 2));
        jButton11.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton11.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton11ActionPerformed(evt);
            }
        });
        jToolBar2.add(jButton11);
        jToolBar2.add(jSeparator8);

        jComboBox1.setMaximumRowCount(10);
        jComboBox1.setEnabled(false);
        jComboBox1.setMaximumSize(new java.awt.Dimension(32767, 26));
        jComboBox1.setMinimumSize(new java.awt.Dimension(300, 26));
        jComboBox1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jComboBox1ActionPerformed(evt);
            }
        });
        jToolBar2.add(jComboBox1);
        jToolBar2.add(jSeparator10);

        jPanel11.add(jToolBar2);

        /*
        jSplitPane4.setRightComponent(jPanel11);
        */
        jSplitPane4.setRightComponent(null);

        jPanel3.add(jSplitPane4, java.awt.BorderLayout.CENTER);

        jSplitPane1.setLeftComponent(jPanel3);

        jSplitPane2.setResizeWeight(0.9);
        jSplitPane2.setPreferredSize(new java.awt.Dimension(300, 300));
        jSplitPane2.setDividerLocation(0.65);
        jSplitPane2.addHierarchyBoundsListener(new java.awt.event.HierarchyBoundsListener() {
            public void ancestorMoved(java.awt.event.HierarchyEvent evt) {
            }
            public void ancestorResized(java.awt.event.HierarchyEvent evt) {
                jSplitPane2AncestorResized(evt);
            }
        });

        jPanel6.setLayout(new java.awt.BorderLayout());

        jLabel3.setBackground(new java.awt.Color(36, 29, 21));
        jLabel3.setFont(new java.awt.Font("DejaVu Sans", 1, 13)); // NOI18N
        jLabel3.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel3.setText(" ");
        jPanel6.add(jLabel3, java.awt.BorderLayout.NORTH);

        jSplitPane5.setDividerSize(0);
        jSplitPane5.setOrientation(javax.swing.JSplitPane.VERTICAL_SPLIT);

        jScrollPane6.setVisible(false);
        jScrollPane6.setHorizontalScrollBarPolicy(javax.swing.ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
        jScrollPane6.setVerticalScrollBarPolicy(javax.swing.ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);
        jScrollPane6.setEnabled(false);

        jTable3.setRowHeight(52);
        jTable3.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        jScrollPane6.setViewportView(jTable3);
        restoreSortingContextsTable();
        jTable3.setDefaultRenderer(Routine.class, new PlotThumbRenderer());

        jTable3.getSelectionModel().addListSelectionListener(new javax.swing.event.ListSelectionListener() {
            public void valueChanged(javax.swing.event.ListSelectionEvent evt) {
                jTable3ValueChanged(evt);
            }
        });

        jSplitPane5.setBottomComponent(jScrollPane6);

        jScrollPane1.setVerticalScrollBarPolicy(javax.swing.ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);

        jTable1.setDoubleBuffered(true);
        //jTable1.setAutoCreateColumnsFromModel(false);
        jTable1.setRowHeight(52);
        jTable1.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        restoreSortingRoutinesTable();
        jTable1.setDefaultRenderer(Routine.class, new PlotThumbRenderer());
        jTable1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTable1MouseClicked(evt);
            }
        });
        jTable1.getSelectionModel().addListSelectionListener(new javax.swing.event.ListSelectionListener() {
            public void valueChanged(javax.swing.event.ListSelectionEvent evt) {
                jTable1ValueChanged(evt);
            }
        });
        /*
        jTable1.getModel().addTableModelListener(new javax.swing.event.TableModelListener() {
            public void tableChanged(javax.swing.event.TableModelEvent evt) {
                jTable1TableChanged(evt);
            }
        });
        */
        jScrollPane1.setViewportView(jTable1);

        jSplitPane5.setTopComponent(jScrollPane1);

        jPanel6.add(jSplitPane5, java.awt.BorderLayout.CENTER);

        jSplitPane2.setLeftComponent(jPanel6);

        jSplitPane3.setOrientation(javax.swing.JSplitPane.VERTICAL_SPLIT);
        jSplitPane3.setDividerSize(0);

        jPanel4.setMinimumSize(new java.awt.Dimension(26, 100));
        jPanel4.setLayout(new java.awt.BorderLayout());

        jScrollPane2.setVerticalScrollBarPolicy(javax.swing.ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);
        jScrollPane2.setPreferredSize(new java.awt.Dimension(550, 450));

        jTable2.setModel(new RmsTableModel(this));
        jTable2.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        restoreSortingRmsTable();
        jTable2.getSelectionModel().addListSelectionListener(new javax.swing.event.ListSelectionListener() {
            public void valueChanged(javax.swing.event.ListSelectionEvent evt) {
                jTable2ValueChanged(evt);
            }
        });
        jScrollPane2.setViewportView(jTable2);

        jPanel4.add(jScrollPane2, java.awt.BorderLayout.CENTER);

        jSplitPane3.setTopComponent(jPanel4);

        jPanel5.setLayout(new java.awt.BorderLayout());

        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel2.setText("Stack trace");
        jPanel5.add(jLabel2, java.awt.BorderLayout.NORTH);

        jList1.setModel(new StackTraceListModel());
        jList1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jList1MouseClicked(evt);
            }
        });
        jScrollPane3.setViewportView(jList1);

        jPanel5.add(jScrollPane3, java.awt.BorderLayout.CENTER);

        jSplitPane3.setRightComponent(jPanel5);
        jPanel5.setVisible(false);

        jTabbedPane1.addTab("Routine profile", jSplitPane3);

        jPanel8.setPreferredSize(new java.awt.Dimension(164, 362));
        jPanel8.setLayout(new java.awt.BorderLayout());

        jTree1.setModel(new DefaultTreeModel(null));
        jTree1.setRootVisible(false);
        jScrollPane4.setViewportView(jTree1);

        jPanel8.add(jScrollPane4, java.awt.BorderLayout.CENTER);

        if (report != null && report.hasContexts()) {
            jTabbedPane1.addTab("Context tree", jPanel8);
        }

        jSplitPane2.setRightComponent(jTabbedPane1);

        jSplitPane1.setBottomComponent(jSplitPane2);

        jPanel2.add(jSplitPane1, java.awt.BorderLayout.CENTER);

        getContentPane().add(jPanel2, java.awt.BorderLayout.CENTER);

        jMenu1.setMnemonic('f');
        jMenu1.setText("File");

        jMenuItem1.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_N, java.awt.event.InputEvent.CTRL_MASK));
        jMenuItem1.setMnemonic('n');
        jMenuItem1.setText("New window");
        jMenuItem1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem1ActionPerformed(evt);
            }
        });
        jMenu1.add(jMenuItem1);
        jMenu1.add(jSeparator1);

        jMenuItem5.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_O, java.awt.event.InputEvent.SHIFT_MASK | java.awt.event.InputEvent.CTRL_MASK));
        jMenuItem5.setMnemonic('o');
        jMenuItem5.setText("Open file...");
        jMenuItem5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem5ActionPerformed(evt);
            }
        });
        jMenu1.add(jMenuItem5);

        jMenuItem8.setText("Set source directory");
        jMenuItem8.setEnabled(false);
        jMenuItem8.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem8ActionPerformed(evt);
            }
        });
        jMenu1.add(jMenuItem8);

        jMenu5.setMnemonic('r');
        jMenu5.setText("Open recent file");

        recentMenuItem1.setText("recent file");
        recentMenuItem1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                recentMenuItem1ActionPerformed(evt);
            }
        });
        jMenu5.add(recentMenuItem1);
        recentMenuItems[0] = recentMenuItem1;

        recentMenuItem2.setText("recent file");
        recentMenuItem2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                recentMenuItem2ActionPerformed(evt);
            }
        });
        jMenu5.add(recentMenuItem2);
        recentMenuItems[1] = recentMenuItem2;

        recentMenuItem3.setText("recent file");
        recentMenuItem3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                recentMenuItem3ActionPerformed(evt);
            }
        });
        jMenu5.add(recentMenuItem3);
        recentMenuItems[2] = recentMenuItem3;

        recentMenuItem4.setText("recent file");
        recentMenuItem4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                recentMenuItem4ActionPerformed(evt);
            }
        });
        jMenu5.add(recentMenuItem4);
        recentMenuItems[3] = recentMenuItem4;

        recentMenuItem5.setText("recent file");
        recentMenuItem5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                recentMenuItem5ActionPerformed(evt);
            }
        });
        jMenu5.add(recentMenuItem5);
        recentMenuItems[4] = recentMenuItem5;

        recentMenuItem6.setText("recent file");
        recentMenuItem6.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                recentMenuItem6ActionPerformed(evt);
            }
        });
        jMenu5.add(recentMenuItem6);
        recentMenuItems[5] = recentMenuItem6;

        jMenu1.add(jMenu5);

        jMenuItem6.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_S, java.awt.event.InputEvent.CTRL_MASK));
        jMenuItem6.setText("Save");
        jMenuItem6.setEnabled(false);
        jMenuItem6.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem6ActionPerformed(evt);
            }
        });
        jMenu1.add(jMenuItem6);

        jMenu6.setText("Export");
        jMenu6.setEnabled(false);

        jMenuItem11.setText("Routine profile...");
        jMenuItem11.setEnabled(false);
        jMenuItem11.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem11ActionPerformed(evt);
            }
        });
        jMenu6.add(jMenuItem11);

        jMenuItem12.setText("Program profile...");
        jMenuItem12.setEnabled(false);
        jMenuItem12.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem12ActionPerformed(evt);
            }
        });
        jMenu6.add(jMenuItem12);

        jMenuItem13.setText("Program statistics...");
        jMenuItem13.setEnabled(false);
        jMenuItem13.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem13ActionPerformed(evt);
            }
        });
        jMenu6.add(jMenuItem13);

        jMenuItem14.setText("Input volume...");
        jMenuItem14.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem14ActionPerformed(evt);
            }
        });
        jMenu6.add(jMenuItem14);

        jMenuItem15.setText("Routine profile richness...");
        jMenuItem15.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem15ActionPerformed(evt);
            }
        });
        jMenu6.add(jMenuItem15);

        jMenuItem16.setText("Thread input...");
        jMenuItem16.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem16ActionPerformed(evt);
            }
        });
        jMenu6.add(jMenuItem16);

        jMenuItem17.setText("External input...");
        jMenuItem17.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem17ActionPerformed(evt);
            }
        });
        jMenu6.add(jMenuItem17);

        jMenuItem19.setText("Induced accesses...");
        jMenuItem19.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem19ActionPerformed(evt);
            }
        });
        jMenu6.add(jMenuItem19);

        jMenuItem20.setText("Self induced accesses...");
        jMenuItem20.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem20ActionPerformed(evt);
            }
        });
        jMenu6.add(jMenuItem20);

        jMenuItem18.setText("All input stats...");
        jMenuItem18.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem18ActionPerformed(evt);
            }
        });
        jMenu6.add(jMenuItem18);

        jMenuItem21.setText("Alpha values...");
        jMenuItem21.setEnabled(false);
        jMenuItem21.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem21ActionPerformed(evt);
            }
        });
        jMenu6.add(jMenuItem21);

        jMenu1.add(jMenu6);

        jMenuItem7.setText("Merge...");
        jMenuItem7.setEnabled(false);
        jMenuItem7.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem7ActionPerformed(evt);
            }
        });
        jMenu1.add(jMenuItem7);
        jMenu1.add(jSeparator4);

        jMenuItem2.setMnemonic('x');
        jMenuItem2.setText("Exit");
        jMenuItem2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem2ActionPerformed(evt);
            }
        });
        jMenu1.add(jMenuItem2);

        jMenuBar1.add(jMenu1);

        jMenu2.setMnemonic('e');
        jMenu2.setText("Edit");

        jMenuItem4.setMnemonic('s');
        jMenuItem4.setText("Settings...");
        jMenuItem4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem4ActionPerformed(evt);
            }
        });
        jMenu2.add(jMenuItem4);

        jMenuBar1.add(jMenu2);

        jMenu3.setMnemonic('v');
        jMenu3.setText("View");

        jCheckBoxMenuItem12.setText("Cost plot");
        jCheckBoxMenuItem12.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem12ActionPerformed(evt);
            }
        });
        jMenu3.add(jCheckBoxMenuItem12);

        jCheckBoxMenuItem15.setText("Amortized cost plot");
        jCheckBoxMenuItem15.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem15ActionPerformed(evt);
            }
        });
        jMenu3.add(jCheckBoxMenuItem15);

        jCheckBoxMenuItem18.setText("Rms frequency plot");
        jCheckBoxMenuItem18.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem18ActionPerformed(evt);
            }
        });
        jMenu3.add(jCheckBoxMenuItem18);

        jCheckBoxMenuItem13.setText("Min/Avg/Max cost plot");
        jCheckBoxMenuItem13.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem13ActionPerformed(evt);
            }
        });
        jMenu3.add(jCheckBoxMenuItem13);

        jCheckBoxMenuItem14.setText("Total cost plot");
        jCheckBoxMenuItem14.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem14ActionPerformed(evt);
            }
        });
        jMenu3.add(jCheckBoxMenuItem14);

        jCheckBoxMenuItem17.setText("Cost variance plot");
        jCheckBoxMenuItem17.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem17ActionPerformed(evt);
            }
        });
        jMenu3.add(jCheckBoxMenuItem17);

        jCheckBoxMenuItem16.setText("Curve bounding plot");
        jCheckBoxMenuItem16.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem16ActionPerformed(evt);
            }
        });
        jMenu3.add(jCheckBoxMenuItem16);

        jCheckBoxMenuItem24.setText("Alpha plot");
        jCheckBoxMenuItem24.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem24ActionPerformed(evt);
            }
        });
        jMenu3.add(jCheckBoxMenuItem24);

        jCheckBoxMenuItem1.setText("Source code editor");
        jCheckBoxMenuItem1.setEnabled(false);
        jCheckBoxMenuItem1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxMenuItem1ActionPerformed(evt);
            }
        });
        jMenu3.add(jCheckBoxMenuItem1);

        jMenuBar1.add(jMenu3);

        jMenu4.setMnemonic('h');
        jMenu4.setText("Help");

        jMenuItem3.setMnemonic('a');
        jMenuItem3.setText("About");
        jMenuItem3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem3ActionPerformed(evt);
            }
        });
        jMenu4.add(jMenuItem3);

        jMenuBar1.add(jMenu4);

        setJMenuBar(jMenuBar1);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    public void postStart() {
       contexts_divider = jSplitPane5.getSize().height / 2;
    }
    
    public boolean setVisibleContextsTable(boolean visible) {
       
       //System.out.println("Set visible");
       //Thread.dumpStack();
        
       boolean old = jScrollPane6.isVisible();
       if (old)
          contexts_divider = jSplitPane5.getDividerLocation();
       
       if (visible) {
           
           jSplitPane5.setDividerSize(6);
           jSplitPane5.setDividerLocation(contexts_divider);
           jScrollPane6.setVisible(visible);
           //scrollToVisibleRoutinesTable();
           
       } else {
           
           jScrollPane6.setVisible(visible);
           jSplitPane5.setDividerSize(0);
           jSplitPane5.setDividerLocation(1.0);
       }
       
       return old;
    }
    
    public boolean isVisibleContextsTable() {
       return jScrollPane6.isVisible();
    }
    
	public void checkEditor() {

		if(isCtagsInstalled()) {
			
			jMenuItem8.setEnabled(true);
			jButton10.setEnabled(true);
			jCheckBoxMenuItem1.setEnabled(true);
			jToggleButton1.setEnabled(true);
			createTextEditor();
			if (Main.getEditorVisible())
				showTextEditor(true);
		
		} else {
			
			jMenuItem8.setEnabled(false);
			jButton10.setEnabled(false);
			jCheckBoxMenuItem1.setEnabled(false);
			jToggleButton1.setEnabled(false);
			if (Main.getEditorVisible())
				showTextEditor(false);
		
		}
	
	}
	
	public AprofReport getCurrentReport(){
		return report;
    }
    
	private void setVisibleStackTrace(boolean show) {
		
        if (jPanel5.isVisible())
            stack_trace_divider = jSplitPane3.getDividerLocation();
        
        if (show) {
            
			jSplitPane3.setDividerSize(6);
            if (stack_trace_divider > 0)
    			jSplitPane3.setDividerLocation(stack_trace_divider);
			else
                jSplitPane3.setDividerLocation(0.5);
            
            jPanel5.setVisible(true);
            
		} else {
            
            jPanel5.setVisible(false);
			jSplitPane3.setDividerSize(0);
		
        }
	}
	
	protected final void refreshRecentFiles() {
		hideRecentMenuItems();
		java.util.ArrayList<java.io.File> recent = Main.getRecentFiles();
		if (recent.isEmpty()) jMenu5.setEnabled(false);
		else {
			jMenu5.setEnabled(true);
			for (int i = 0; i < recent.size(); i++) {
				recentMenuItems[i].setText(recent.get(i).getName());
				recentMenuItems[i].setVisible(true);
			}
		}
	}

	private void hideRecentMenuItems() {
		jMenu5.setEnabled(false);
		recentMenuItem1.setVisible(false);
		recentMenuItem2.setVisible(false);
		recentMenuItem3.setVisible(false);
		recentMenuItem4.setVisible(false);
		recentMenuItem5.setVisible(false);
		recentMenuItem6.setVisible(false);
	}

	private void updateGUI(java.io.File file) {
		
		this.setTitle(file.toString() + " - aprof-plot");
		jLabel3.setText("Profile report for " + report.getAppName() + " (" + report.getCommandLine() + ")");
		jLabel1.setText(" Routines: " + report.getRoutineCount() + " ");
		jLabel4.setText(" Contexts: " + report.getContextsCount() + " ");
        String tcos = String.format(" Total cost: %d ", (long)report.getTotalCost());
        jLabel5.setText(tcos);
		/*
        if (report.getTotalCost() < 10000)
			jLabel5.setText(" Total cost: " + report.getTotalCost() + " ");
		else {
			double exp = Math.log10(report.getTotalCost());
			String exp10 = String.format("%.2f", exp);
			jLabel5.setText(" Total cost: 10^" + exp10  + " ");
		}
        */
		jLabel6.setText(" Calls: " + report.getTotalCalls() + " ");
		jLabel7.setText("");
        
        if (this.isInputMetricRms()) {
            jCheckBoxMenuItem18.setText("RMS frequency plot");
            jCheckBoxMenuItem10.setText("RMS frequency plot");
        } else {
            jCheckBoxMenuItem18.setText("DRMS frequency plot");
            jCheckBoxMenuItem10.setText("DRMS frequency plot");
        }
        
	}

	protected void loadReport(final File file) {
		
		//System.out.println("Loading[1]: " + file);
		
		loading = true;
		jProgressBar1.setVisible(true);
		jProgressBar1.setEnabled(true);
		
		SwingWorker worker = new SwingWorker<AprofReport, Void>() {
			
			@Override
			public AprofReport doInBackground() {
				try {
					setReport(new AprofReport(file), file);
				} catch (Exception ex) {
                    ex.printStackTrace();
					System.out.println("Fail to load");
					System.out.println(ex);
                    jProgressBar1.setVisible(false);
                    jProgressBar1.setEnabled(false);
                    failLoadReport(file, ex);
				}
				return report;
			}
			
		};
		worker.execute();
		
	}
    
    public boolean isInputMetricRms() {
        
        if (report == null) return true;
        
        if (report.getInputMetric() == AprofReport.InputMetric.DRMS)
            return false;
        
        return true;
    }
    
    private void failLoadReport(File file, Exception e) {
        
        //System.out.println(e);
        //e.printStackTrace();
        
        javax.swing.JOptionPane.showMessageDialog(this, 
                "Couldn't open the chosen file", "Error", 
                javax.swing.JOptionPane.ERROR_MESSAGE);
    }
    
    @SuppressWarnings("unchecked")
    public void saveSortingRoutinesTable() {
        routines_sort = (List<RowSorter.SortKey>) routines_table_sorter.getSortKeys(); 
    }
    
    public void restoreSortingRoutinesTable() {
        
        if (routines_table_sorter == null) {
            
            routines_table_sorter = new TableRowSorter<TableModel>(jTable1.getModel());
            jTable1.setRowSorter(routines_table_sorter);
            
        }
        
        /* default: sort by RMS */
        if (routines_sort == null) {
            
            routines_sort = new ArrayList<RowSorter.SortKey>();
            routines_sort.add(new RowSorter.SortKey(3, SortOrder.DESCENDING));
            
        }
            
        routines_table_sorter.setSortKeys(routines_sort);
        routines_table_sorter.setSortable(5, false);
        
    }
    
    @SuppressWarnings("unchecked")
    public void saveSortingRmsTable() {
        rms_sort = (List<RowSorter.SortKey>) rms_table_sorter.getSortKeys(); 
    }
    
    public void restoreSortingRmsTable() {
        
        if (rms_table_sorter == null) {
            
            rms_table_sorter = new TableRowSorter<TableModel>(jTable2.getModel());
            jTable2.setRowSorter(rms_table_sorter);
            
        }
        
        /* default: sort by RMS */
        if (rms_sort == null) {
            
            rms_sort = new ArrayList<RowSorter.SortKey>();
            rms_sort.add(new RowSorter.SortKey(0, SortOrder.ASCENDING));
            
        }
        
        rms_table_sorter.setSortKeys(rms_sort);
    }
    
    @SuppressWarnings("unchecked")
    public void saveSortingContextsTable() {
        contexts_sort = (List<RowSorter.SortKey>) contexts_table_sorter.getSortKeys(); 
    }
    
    public void restoreSortingContextsTable() {
        
        if (contexts_table_sorter == null) {
            
            contexts_table_sorter = new TableRowSorter<TableModel>(jTable3.getModel());
            jTable3.setRowSorter(contexts_table_sorter);
            
        }
        
        setComparatorContexts();
        
        /* default: sort by RMS */
        if (contexts_sort == null) {
            
            contexts_sort = new ArrayList<RowSorter.SortKey>();
            contexts_sort.add(new RowSorter.SortKey(3, SortOrder.DESCENDING));
            
        }
        
        contexts_table_sorter.setSortKeys(contexts_sort);
        contexts_table_sorter.setSortable(5, false);
       
    }
    
    private void setComparatorContexts() {
        
        if (report == null) return;
        
        if (report.hasContexts()) {

            final Comparator<String> contextOrder = new Comparator<String>() {

               @Override
               public int compare(String t, String t1) {

                   if (t == null && t1 == null) return 0;
                   if (t == null) return 1;
                   if (t1 == null) return -1;

                   int i1 = t.indexOf("/");
                   int i2 = t1.indexOf("/");

                   int c1 = 0; int c1_n = 0;
                   int c2 = 0; int c2_n = 0;

                   if (i1 < 0) {

                       if (t.equals("")) c1 = 0;
                       else c1 = Integer.parseInt(t);

                   } else {

                       c1_n = Integer.parseInt(t.substring(0, i1));
                       c1 = Integer.parseInt(t.substring(i1 + 1));

                   }

                   if (i2 < 0) {

                       if (t1.equals("")) c2 = 0;
                       else c2 = Integer.parseInt(t1);

                   } else {

                       //System.out.println(t1 + " " + t1.substring(0, i2) + " / " + t1.substring(i2 + 1));
                       c2_n = Integer.parseInt(t1.substring(0, i2));
                       c2 = Integer.parseInt(t1.substring(i2 + 1));

                   }

                   if (c1 != c2) return c1 - c2;

                   return c1_n - c2_n;

               }

            };

            contexts_table_sorter.setComparator(8, contextOrder);

       }
    }
    
	private void setReport(AprofReport report, File file) throws Exception {
		
		/*
		boolean oldReportHasContext = false;
		if (this.report != null && this.report.hasContexts())
			oldReportHasContext = true;
		*/
		      
		this.report = report;
		Main.addRecentFile(file);
		refreshRecentFiles();
        
		// reload button
		jButton9.setEnabled(true);
		jButton9.setToolTipText("Reload this report");
		
		// enable entries in export menu
		jMenu6.setEnabled(true);
		jMenuItem12.setEnabled(true);
		jMenuItem13.setEnabled(true);
		
		resetRoutineTableFilter();
		
		// Update some labels in the GUI
		updateGUI(file);
		
		// Clear all graphs
		if (jCheckBoxMenuItem4.isSelected()) CostGraphPanel.clearData();
		if (jCheckBoxMenuItem8.isSelected()) ratioGraphPanel.clearData();
		if (jCheckBoxMenuItem10.isSelected()) freqGraphPanel.clearData();
		if (jCheckBoxMenuItem5.isSelected()) MMMGraphPanel.clearData();
		if (jCheckBoxMenuItem9.isSelected()) VarGraphPanel.clearData();
		if (jCheckBoxMenuItem6.isSelected()) TotalCostGraphPanel.clearData();
		if (jCheckBoxMenuItem7.isSelected()) AmortizedGraphPanel.clearData();
		if (jCheckBoxMenuItem24.isSelected()) AlphaGraphPanel.setData(null);
        
        /*
        if (jCheckBoxMenuItem11.isSelected()) RtnGraphPanel.setData(null);
        if (jCheckBoxMenuItem22.isSelected()) RatioTuplesGraphPanel.setData(null);
        if (jCheckBoxMenuItem23.isSelected()) ExternalInputGraphPanel.setData(null);
		*/
        
		// Update routine table: we change data in table, this must be done by swing thread
		final AprofReport final_report = report;
		SwingUtilities.invokeLater(new Runnable() {
			
			@Override
			public void run() { 
                
				RoutinesTableModel m = (RoutinesTableModel)jTable1.getModel();
                saveSortingRoutinesTable();
				m.setData(final_report);
                restoreSortingRoutinesTable();
                
                RoutinesTableModel m2 = (RoutinesTableModel)jTable3.getModel();
                saveSortingContextsTable();
				m2.setData(final_report);
                restoreSortingContextsTable();
				
				// Clear routinr profile
				((RmsTableModel)jTable2.getModel()).setData(null);
                ((RmsTableModel)jTable2.getModel()).refreshStructure();
                
                freqGraphPanel.updateGraphTitle();
                
				jProgressBar1.setVisible(false);
				jProgressBar1.setEnabled(false);
				loading = false;
				
			}
		
		});
		
		
		
	}

	private boolean saveForm() {
	
		if (jButton7.isEnabled()) {
			int choice = javax.swing.JOptionPane.showConfirmDialog(this,
													  "Do you want to save changes to this report?",
													  "Unsaved changes",
													  javax.swing.JOptionPane.YES_NO_CANCEL_OPTION,
													  javax.swing.JOptionPane.QUESTION_MESSAGE);
			if (choice == javax.swing.JOptionPane.CANCEL_OPTION) return false;
			if (choice == javax.swing.JOptionPane.OK_OPTION) {
				try {
					report.save();
				} catch (Exception e) {
					javax.swing.JOptionPane.showMessageDialog(this, "Can't save report", "Error", javax.swing.JOptionPane.ERROR_MESSAGE);
				}
			}
			
		}
        return true;
	}
	
	private void openFile() {
		
		saveForm();
		disableSaveCommand();
		
		javax.swing.JFileChooser chooser = new javax.swing.JFileChooser();
		String lastReportPath = Main.getLastReportPath();
		if (!lastReportPath.equals("")) chooser.setCurrentDirectory(new java.io.File(lastReportPath));
		javax.swing.filechooser.FileNameExtensionFilter filter = new javax.swing.filechooser.FileNameExtensionFilter("Aprof report files (*.aprof)", "aprof");
		chooser.setFileFilter(filter);
		chooser.setAcceptAllFileFilterUsed(false);
		int choice = chooser.showOpenDialog(this);
		if (choice == javax.swing.JFileChooser.APPROVE_OPTION) {
			java.io.File file = chooser.getSelectedFile();
			Main.storeLastReportPath(file.getParent());
            loadReport(file);
		}
	
	}

	protected void refreshTables() {
		
		int viewIndex = jTable1.getSelectedRow();
		int viewIndex2 = jTable2.getSelectedRow();
		((RmsTableModel)jTable2.getModel()).setData(rtn_info);
		if (viewIndex2 >= 0) {
			int modelIndex2 = jTable1.convertRowIndexToModel(viewIndex2);
			viewIndex2 = jTable1.convertRowIndexToView(modelIndex2);
			jTable2.setRowSelectionInterval(viewIndex2, viewIndex2);
			if (jTable2.getParent() instanceof javax.swing.JViewport) { // Scroll to visible; thanks to fiontan
				javax.swing.JViewport viewport = (javax.swing.JViewport)jTable2.getParent();
				java.awt.Rectangle rect = jTable2.getCellRect(viewIndex2, 0, true);
				java.awt.Point pos = viewport.getViewPosition();
				rect.translate(-pos.x, -pos.y);
				viewport.scrollRectToVisible(rect);
			}
		}
	}
    
    public void refreshRoutinesTable() {
        saveSortingRoutinesTable();
        ((RoutinesTableModel)jTable1.getModel()).setData(report);
        setRoutinesTableFilter(routines_filter_criteria);
        restoreSortingRoutinesTable();
    }
    
    public void refreshContextsTable() {
        
        if (isVisibleContextsTable()) {
            
            if (rtn_info instanceof RoutineContext)
                ((RoutinesTableModel)jTable1.getModel()).loadContexts(
                        ((RoutineContext)rtn_info).getOverallRoutine(), true);
            else
                ((RoutinesTableModel)jTable1.getModel()).loadContexts(rtn_info, true);
        }
        //setRoutinesTableFilter(routines_filter_criteria);
        
    }
    
    public void refreshRmsTable(boolean skip_refresh_plot) {
        saveSortingRmsTable();
        ((RmsTableModel)jTable2.getModel()).setData(rtn_info);
        ((RmsTableModel)jTable2.getModel()).refreshStructure();
        if (skip_refresh_plot) refreshRmsTableFilter();
        restoreSortingRmsTable();
    }

	protected boolean arePlotsLinked() {
		return this.linked_plots;
	}

	protected void setXLogScaleAll(int graph_type, boolean log) {
		
		// this method is called by one graph, we notify to all others...
		
		if (graph_type != GraphPanel.COST_PLOT) 
            CostGraphPanel.setXLogScale(log);
		if (graph_type != GraphPanel.RATIO_PLOT) 
            ratioGraphPanel.setXLogScale(log);
		if (graph_type != GraphPanel.FREQ_PLOT) 
            freqGraphPanel.setXLogScale(log);
		if (graph_type != GraphPanel.MMM_PLOT) 
            MMMGraphPanel.setXLogScale(log);
		if (graph_type != GraphPanel.VAR_PLOT) 
            VarGraphPanel.setXLogScale(log);
		if (graph_type != GraphPanel.TOTALCOST_PLOT) 
            TotalCostGraphPanel.setXLogScale(log);
		if (graph_type != GraphPanel.RTN_PLOT) 
            RtnGraphPanel.setXLogScale(log);
		if (graph_type != GraphPanel.AMORTIZED_PLOT) 
            AmortizedGraphPanel.setXLogScale(log);
        if (graph_type != GraphPanel.RATIO_TUPLES_PLOT) 
            RatioTuplesGraphPanel.setXLogScale(log);
        if (graph_type != GraphPanel.EXTERNAL_INPUT_PLOT) 
            ExternalInputGraphPanel.setXLogScale(log);
        if (graph_type != GraphPanel.ALPHA_PLOT) 
            AlphaGraphPanel.setXLogScale(log);
        
	}

	protected void setYLogScaleAll(int graph_type, boolean log) {
		
		// this method is called by one graph, we notify to all others...
		
		if (graph_type != GraphPanel.COST_PLOT) 
            CostGraphPanel.setYLogScale(log);
		if (graph_type != GraphPanel.RATIO_PLOT) 
            ratioGraphPanel.setYLogScale(log);
		if (graph_type != GraphPanel.FREQ_PLOT) 
            freqGraphPanel.setYLogScale(log);
		if (graph_type != GraphPanel.MMM_PLOT) 
            MMMGraphPanel.setYLogScale(log);
		if (graph_type != GraphPanel.TOTALCOST_PLOT) 
            TotalCostGraphPanel.setYLogScale(log);
		if (graph_type != GraphPanel.VAR_PLOT) 
            VarGraphPanel.setYLogScale(log);
		if (graph_type != GraphPanel.AMORTIZED_PLOT) 
            AmortizedGraphPanel.setYLogScale(log);
		if (graph_type != GraphPanel.RTN_PLOT) 
            RtnGraphPanel.setYLogScale(log);
        if (graph_type != GraphPanel.RATIO_TUPLES_PLOT) 
            RatioTuplesGraphPanel.setYLogScale(log);
        if (graph_type != GraphPanel.EXTERNAL_INPUT_PLOT) 
            ExternalInputGraphPanel.setYLogScale(log);
        if (graph_type != GraphPanel.ALPHA_PLOT) 
            AlphaGraphPanel.setYLogScale(log);
	
	}

	protected void maximizeAll(int graph_type) {

		// this method is called by one graph, we notify to all others...
		
		if (graph_type != GraphPanel.COST_PLOT) 
            CostGraphPanel.maximize();
		if (graph_type != GraphPanel.RATIO_PLOT) 
            ratioGraphPanel.maximize();
		if (graph_type != GraphPanel.FREQ_PLOT) 
            freqGraphPanel.maximize();
		if (graph_type != GraphPanel.MMM_PLOT) 
            MMMGraphPanel.maximize();
		if (graph_type != GraphPanel.TOTALCOST_PLOT) 
            TotalCostGraphPanel.maximize();
		if (graph_type != GraphPanel.VAR_PLOT) 
            VarGraphPanel.maximize();
		if (graph_type != GraphPanel.RTN_PLOT) 
            RtnGraphPanel.maximize();
		if (graph_type != GraphPanel.AMORTIZED_PLOT) 
            AmortizedGraphPanel.maximize();
        if (graph_type != GraphPanel.RATIO_TUPLES_PLOT) 
            RatioTuplesGraphPanel.maximize();
        if (graph_type != GraphPanel.EXTERNAL_INPUT_PLOT) 
            ExternalInputGraphPanel.maximize();
        if (graph_type != GraphPanel.ALPHA_PLOT) 
            AlphaGraphPanel.maximize();
	
	}

	protected void setGroupThresholdAll(int graph_type, int threshold) {
		
		// this method is called by one graph, we notify to all others...
		
		if (graph_type != GraphPanel.COST_PLOT) CostGraphPanel.setGroupThreshold(threshold);
		if (graph_type != GraphPanel.RATIO_PLOT) ratioGraphPanel.setGroupThreshold(threshold);
		if (graph_type != GraphPanel.FREQ_PLOT) freqGraphPanel.setGroupThreshold(threshold);
		if (graph_type != GraphPanel.MMM_PLOT) MMMGraphPanel.setGroupThreshold(threshold);
		if (graph_type != GraphPanel.TOTALCOST_PLOT) TotalCostGraphPanel.setGroupThreshold(threshold);
		if (graph_type != GraphPanel.VAR_PLOT) VarGraphPanel.setGroupThreshold(threshold);
		if (graph_type != GraphPanel.AMORTIZED_PLOT) AmortizedGraphPanel.setGroupThreshold(threshold);
	
	}

	protected void setSmoothThresholdAll(int graph_type, int threshold) {
		
		// this method is called by one graph, we notify to all others...
		
		if (graph_type != GraphPanel.COST_PLOT) CostGraphPanel.setSmoothThreshold(threshold);
		if (graph_type != GraphPanel.RATIO_PLOT) ratioGraphPanel.setSmoothThreshold(threshold);
		if (graph_type != GraphPanel.FREQ_PLOT) freqGraphPanel.setSmoothThreshold(threshold);
		if (graph_type != GraphPanel.MMM_PLOT) MMMGraphPanel.setSmoothThreshold(threshold);
		if (graph_type != GraphPanel.TOTALCOST_PLOT) TotalCostGraphPanel.setSmoothThreshold(threshold);
		if (graph_type != GraphPanel.VAR_PLOT) VarGraphPanel.setSmoothThreshold(threshold);
		if (graph_type != GraphPanel.AMORTIZED_PLOT) AmortizedGraphPanel.setSmoothThreshold(threshold);
	
	}
	
	protected void setGroupCostAll(int graph_type, int cost_type) {
		
		// this method is called by one graph, we notify to all others...
		
		if (graph_type != GraphPanel.COST_PLOT) 
            this.CostGraphPanel.setGroupCost(cost_type);
		if (graph_type != GraphPanel.RATIO_PLOT) 
            this.ratioGraphPanel.setGroupCost(cost_type);
	
	}

	private void formWindowClosing(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosing

		if (!saveForm()) return;
		Main.removeWindow(this);
		this.dispose();
		
	}//GEN-LAST:event_formWindowClosing

	private void jMenuItem1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem1ActionPerformed
		Main.newWindow();
	}//GEN-LAST:event_jMenuItem1ActionPerformed

	private void jMenuItem2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem2ActionPerformed
		formWindowClosing(null);
	}//GEN-LAST:event_jMenuItem2ActionPerformed

	private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
		
		openFile();
		
	}//GEN-LAST:event_jButton1ActionPerformed

	public void inhibit_selection(boolean inhibit) {
	
		loading = inhibit;
	
	}
	
    private void loadRoutine(Routine r) {
        
        this.rtn_info = r;
        
        if (r == null) {
            
            ((RmsTableModel)jTable2.getModel()).setData(null);
            
            if (isVisibleContextsTable())
                ((RoutinesTableModel)jTable1.getModel()).loadContexts(null, false);
			
            ((StackTraceListModel)jList1.getModel()).setData(null);
            
            //System.out.println("Reset routine");
			//Thread.dumpStack();
            jLabel7.setText("");
			
			if (jCheckBoxMenuItem4.isSelected()) CostGraphPanel.clearData();
            if (jCheckBoxMenuItem7.isSelected()) AmortizedGraphPanel.clearData();
            if (jCheckBoxMenuItem10.isSelected()) freqGraphPanel.clearData();
            if (jCheckBoxMenuItem5.isSelected()) MMMGraphPanel.clearData();
            if (jCheckBoxMenuItem6.isSelected()) TotalCostGraphPanel.clearData();
			if (jCheckBoxMenuItem9.isSelected()) VarGraphPanel.clearData();
            if (jCheckBoxMenuItem8.isSelected()) ratioGraphPanel.clearData();
            
			//updateContextTree(null);
			
			// Initially hide stack trace panel
			setVisibleStackTrace(false);
            return;
        }
        
        //System.out.println("Refresh routine");
        
        String name = r.getName();
        
        if (r instanceof RoutineContext) {
            name += (" (" +((RoutineContext)r).getContextId() + "/" +
                    ((RoutineContext)r).getOverallRoutine().getContextCount() 
                    + ")");
        }
        jLabel7.setText(name);

        // Load function source code in the editor
        if (linked_editor)
            loadFunctionInTextEditor(name);

        // Update all graph (except routine graph)
        /*
        if (jCheckBoxMenuItem4.isSelected()) CostGraphPanel.setData(r);
        if (jCheckBoxMenuItem8.isSelected()) ratioGraphPanel.setData(r);
        if (jCheckBoxMenuItem10.isSelected()) freqGraphPanel.setData(r);
        if (jCheckBoxMenuItem5.isSelected()) MMMGraphPanel.setData(r);
        if (jCheckBoxMenuItem9.isSelected()) VarGraphPanel.setData(r);
        if (jCheckBoxMenuItem6.isSelected()) TotalCostGraphPanel.setData(r);
        if (jCheckBoxMenuItem7.isSelected()) AmortizedGraphPanel.setData(r);
        */

        perf.start(this, PerformanceMonitor.ELABORATE);

        if (jCheckBoxMenuItem4.isSelected()) CostGraphPanel.setRoutine(r);
        if (jCheckBoxMenuItem8.isSelected()) ratioGraphPanel.setRoutine(r);
        if (jCheckBoxMenuItem10.isSelected()) freqGraphPanel.setRoutine(r);
        if (jCheckBoxMenuItem5.isSelected()) MMMGraphPanel.setRoutine(r);
        if (jCheckBoxMenuItem9.isSelected()) VarGraphPanel.setRoutine(r);
        if (jCheckBoxMenuItem6.isSelected()) TotalCostGraphPanel.setRoutine(r);
        if (jCheckBoxMenuItem7.isSelected()) AmortizedGraphPanel.setRoutine(r);
        if (jCheckBoxMenuItem24.isSelected()) AlphaGraphPanel.setRoutine(r);

        r.sortInputTuplesByInput();
        Iterator i = r.getInputTuplesIterator();
        while (i.hasNext()) {

            Rms te = (Rms) i.next();

            if (jCheckBoxMenuItem4.isSelected()) CostGraphPanel.addPoint(te);
            if (jCheckBoxMenuItem8.isSelected()) ratioGraphPanel.addPoint(te);
            if (jCheckBoxMenuItem10.isSelected()) freqGraphPanel.addPoint(te);
            if (jCheckBoxMenuItem5.isSelected()) MMMGraphPanel.addPoint(te);
            if (jCheckBoxMenuItem9.isSelected()) VarGraphPanel.addPoint(te);
            if (jCheckBoxMenuItem6.isSelected()) TotalCostGraphPanel.addPoint(te);
            if (jCheckBoxMenuItem7.isSelected()) AmortizedGraphPanel.addPoint(te);

        }
        if (jCheckBoxMenuItem24.isSelected()) AlphaGraphPanel.populateChart();

        if (jCheckBoxMenuItem4.isSelected()) CostGraphPanel.maximize();
        if (jCheckBoxMenuItem8.isSelected()) ratioGraphPanel.maximize();
        if (jCheckBoxMenuItem10.isSelected()) freqGraphPanel.maximize();
        if (jCheckBoxMenuItem5.isSelected()) MMMGraphPanel.maximize();
        if (jCheckBoxMenuItem9.isSelected()) VarGraphPanel.maximize();
        if (jCheckBoxMenuItem6.isSelected()) TotalCostGraphPanel.maximize();
        if (jCheckBoxMenuItem7.isSelected()) {
            AmortizedGraphPanel.maximize();
            AmortizedGraphPanel.updateGraphTitle();
        }
        if (jCheckBoxMenuItem24.isSelected()) AlphaGraphPanel.maximize();
        
        // enable/disable entries in export menu related to routine
        if (r == null) {
            jMenuItem11.setEnabled(false);
            jMenuItem21.setEnabled(false);
        } else {
            jMenuItem11.setEnabled(true);
            jMenuItem21.setEnabled(true);
        }

        // Update routine profile panel
        ((RmsTableModel)jTable2.getModel()).setData(r);
        
        if (r instanceof ContextualizedRoutineInfo) {
            ((RoutinesTableModel)jTable1.getModel()).loadContexts(r, true);
            refreshContextsTableFilter();
        }
            
        // Update stack trace panel
        if (r instanceof RoutineContext) {

            ((StackTraceListModel)jList1.getModel()).setData(((RoutineContext)r).getStackTrace());
            setVisibleStackTrace(true);

        } else {

            ((StackTraceListModel)jList1.getModel()).setData(null);
            setVisibleStackTrace(false);

        }

        perf.stop(this, PerformanceMonitor.ELABORATE);
        System.gc();
        //updateContextTree(r);
    
    }
    
	private void jTable1ValueChanged(javax.swing.event.ListSelectionEvent evt) {
		
		if (loading) return;
        loading_routine = true;

        int viewIndex = jTable1.getSelectedRow();
        if (viewIndex >= 0) {

            int modelIndex = jTable1.convertRowIndexToModel(viewIndex);
            Routine r = ((RoutinesTableModel)jTable1.getModel()).getRoutine(modelIndex);

            if (rtn_info == r) return;
            //System.out.println("Selected row in routine table");
            loadRoutine(r);

        } else {

            if (rtn_info == null) return;
            //System.out.println("Invalid selectin in routine table");
            setVisibleContextsTable(false);
            loadRoutine(null);

        }

        scrollToVisibleRoutinesTable();
        loading_routine = false;      
        
	}
    
    public void scrollToVisibleRoutinesTable() {
        
        int viewIndex = jTable1.getSelectedRow();
        // Scroll routine table to visible; thanks to fiontan
        if (jTable1.getParent() instanceof javax.swing.JViewport) { 
            javax.swing.JViewport viewport = (javax.swing.JViewport)jTable1.getParent();
            java.awt.Rectangle rect = jTable1.getCellRect(viewIndex, 0, true);
            java.awt.Point pos = viewport.getViewPosition();
            rect.translate(-pos.x, -pos.y);
            viewport.scrollRectToVisible(rect);
        }

    }
    
    private void jTable3ValueChanged(javax.swing.event.ListSelectionEvent evt) {
		
		if (loading) return;
		
		int viewIndex = jTable3.getSelectedRow();
		if (viewIndex >= 0) {
			
            if (viewIndex >= jTable3.getRowCount()) {
                //System.out.println("Invalid row index:" + viewIndex);
            }
            
			int modelIndex = jTable3.convertRowIndexToModel(viewIndex);
			Routine r = ((RoutinesTableModel)jTable3.getModel()).getRoutine(modelIndex);
			
			if (this.rtn_info == r) return;
			//System.out.println("Selected row in context table");
			loadRoutine(r);
			
		} else {
			
            if(true) return;
            if (!isVisibleContextsTable()) return;
            if (!loading_routine) {
                //System.out.println("Selected invalid row in context table");
                loadRoutine(null);
            }
            
		}

		// Scroll routine table to visible; thanks to fiontan
		if (jTable1.getParent() instanceof javax.swing.JViewport) { 
			javax.swing.JViewport viewport = (javax.swing.JViewport)jTable3.getParent();
			java.awt.Rectangle rect = jTable3.getCellRect(viewIndex, 0, true);
			java.awt.Point pos = viewport.getViewPosition();
			rect.translate(-pos.x, -pos.y);
			viewport.scrollRectToVisible(rect);
		}
	}

	private void jTable2ValueChanged(javax.swing.event.ListSelectionEvent evt) {
		
		// Scroll routine profile panel to visible; thanks to fiontan
		int viewIndex = jTable2.getSelectedRow();
		if (jTable2.getParent() instanceof javax.swing.JViewport) { 
			javax.swing.JViewport viewport = (javax.swing.JViewport)jTable2.getParent();
			java.awt.Rectangle rect = jTable2.getCellRect(viewIndex, 0, true);
			java.awt.Point pos = viewport.getViewPosition();
			rect.translate(-pos.x, -pos.y);
			viewport.scrollRectToVisible(rect);
		}
	
	}

	private void jButton5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton5ActionPerformed
		
		// Routine filter button (corner routine table)
		if (report != null) {
			java.util.ArrayList<String> liblist = null;
			liblist = report.getLibList();
			(new RoutinesFilterDialog(this, true, liblist, routines_filter_criteria)).setVisible(true);
		}
	}//GEN-LAST:event_jButton5ActionPerformed

	private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
		// search button
		findRoutineByName();
	}//GEN-LAST:event_jButton2ActionPerformed

	private void jTextField1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField1ActionPerformed
		// search text field
		findRoutineByName();
	}//GEN-LAST:event_jTextField1ActionPerformed

	private void jButton4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton4ActionPerformed
		// Routine profile filter button (corner routine profile panel)
		if (((RmsTableModel)jTable2.getModel()).getRowCount() > 0) {
			(new RmsFilterDialog(this, true, rms_filter_criteria)).setVisible(true);
		}
	}//GEN-LAST:event_jButton4ActionPerformed

	private void jMenuItem5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem5ActionPerformed
		// Menu: File > Open file
		openFile();
	}//GEN-LAST:event_jMenuItem5ActionPerformed

	private void jButton3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton3ActionPerformed
		// Menu: File > New window
		Main.newWindow();
	}//GEN-LAST:event_jButton3ActionPerformed

	private void jMenuItem3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem3ActionPerformed
		// Menu: Help > About
		(new AboutDialog(this, true)).setVisible(true);
	}//GEN-LAST:event_jMenuItem3ActionPerformed

	private void jToggleButton4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jToggleButton4ActionPerformed
		// Link plots button
		if (jToggleButton4.isSelected()) linked_plots = true;
		else linked_plots = false;
	}//GEN-LAST:event_jToggleButton4ActionPerformed

	private void jButton6ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton6ActionPerformed
		// Repor merge button
		(new MergeReportsDialog(this, true)).setVisible(true);
	}//GEN-LAST:event_jButton6ActionPerformed

	public void enableSaveCommand() {
		jButton7.setEnabled(true);
		jMenuItem6.setEnabled(true);
	}

	public void disableSaveCommand() {
		jButton7.setEnabled(false);
		jMenuItem6.setEnabled(false);
	}

	private void jButton7ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton7ActionPerformed
		// Save button
		try {
			report.save();
		} catch (Exception e) {
			javax.swing.JOptionPane.showMessageDialog(this, "Can't save report", "Error", javax.swing.JOptionPane.ERROR_MESSAGE);
			//System.out.println(e.getMessage());
			//e.printStackTrace();
		} finally {
			disableSaveCommand();
		}
	}//GEN-LAST:event_jButton7ActionPerformed

	private void jMenuItem6ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem6ActionPerformed
		// Menu: File > Save
		jButton7ActionPerformed(null);
	}//GEN-LAST:event_jMenuItem6ActionPerformed

	private void jMenuItem4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem4ActionPerformed
		// Menu: Edit > Settings
		(new SettingsDialog(this, true)).setVisible(true);
	}//GEN-LAST:event_jMenuItem4ActionPerformed

	private void jButton8ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton8ActionPerformed
		// Settings button
		(new SettingsDialog(this, true)).setVisible(true);
	}//GEN-LAST:event_jButton8ActionPerformed

	private void jMenuItem7ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem7ActionPerformed
		// Menu: File > Merge
		(new MergeReportsDialog(this, true)).setVisible(true);
	}//GEN-LAST:event_jMenuItem7ActionPerformed

	private void loadRecentFile(int entry) {
		
		ArrayList<File> r = Main.getRecentFiles();
		if (entry < 0 || entry >= r.size()) return;
	
		java.io.File f = Main.getRecentFiles().get(entry);
        saveForm();
        disableSaveCommand();
        loadReport(f);
		
	}
	
	private void recentMenuItem1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_recentMenuItem1ActionPerformed
		// Menu: File > Open recent file > (first entry)
		loadRecentFile(0);
	}//GEN-LAST:event_recentMenuItem1ActionPerformed

	private void recentMenuItem2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_recentMenuItem2ActionPerformed
		// Menu: File > Open recent file > (second entry)
		loadRecentFile(1);
	}//GEN-LAST:event_recentMenuItem2ActionPerformed

	private void recentMenuItem3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_recentMenuItem3ActionPerformed
		// Menu: File > Open recent file > (third entry)
		loadRecentFile(2);
	}//GEN-LAST:event_recentMenuItem3ActionPerformed

	private void recentMenuItem4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_recentMenuItem4ActionPerformed
		// Menu: File > Open recent file > (fourth entry)
		loadRecentFile(3);
	}//GEN-LAST:event_recentMenuItem4ActionPerformed

	private void recentMenuItem5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_recentMenuItem5ActionPerformed
		// Menu: File > Open recent file > (fifth entry)
		loadRecentFile(4);
	}//GEN-LAST:event_recentMenuItem5ActionPerformed

	private void recentMenuItem6ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_recentMenuItem6ActionPerformed
		// Menu: File > Open recent file > (sixth entry)
		loadRecentFile(5);
	}//GEN-LAST:event_recentMenuItem6ActionPerformed

	private void jSplitPane1AncestorResized(java.awt.event.HierarchyEvent evt) {//GEN-FIRST:event_jSplitPane1AncestorResized
		// Moved divider btw graphs and routine panels
		jSplitPane1.setDividerLocation(0.5);
	}//GEN-LAST:event_jSplitPane1AncestorResized

	private void jSplitPane2AncestorResized(java.awt.event.HierarchyEvent evt) {//GEN-FIRST:event_jSplitPane2AncestorResized
		// Moved divider btw routine table and routine profile panel
		jSplitPane2.setDividerLocation(0.75);
	}//GEN-LAST:event_jSplitPane2AncestorResized

	private void jList1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jList1MouseClicked
		// Clicked on an entry inside stack trace panel
		if (evt.getButton() == java.awt.event.MouseEvent.BUTTON1 && evt.getClickCount() == 2) {
			int previousSelectedIndex = jTable1.getSelectedRow();
			Routine previousSelectedRtn = ((RoutinesTableModel)jTable1.getModel()).getRoutine(jTable1.convertRowIndexToModel(previousSelectedIndex));
			int index = jList1.getSelectedIndex();
			if (index < 0) return;
			//System.out.println("jList1 double-clicked: selected index: " + index);
			Routine r = ((StackTraceListModel)jList1.getModel()).getContext(index);
			int modelIndex = ((RoutinesTableModel)jTable1.getModel()).getIndex(r);
			if (modelIndex < 0) {
				//routine is collapsed
				ContextualizedRoutineInfo urtn = ((RoutineContext)r).getOverallRoutine();
				if (urtn.getCollapsed()) ((RoutinesTableModel)jTable1.getModel()).expandRoutine(urtn);
				modelIndex = ((RoutinesTableModel)jTable1.getModel()).getIndex(r);
				if (modelIndex < 0) {
					modelIndex = ((RoutinesTableModel)jTable1.getModel()).getIndex(previousSelectedRtn);
					int viewIndex = jTable1.convertRowIndexToView(modelIndex);
					jTable1.setRowSelectionInterval(viewIndex, viewIndex);
					JOptionPane.showMessageDialog(this, "The selected routine is filtererd or blacklisted\nand cannot be displayed");
					return;
				}
			}
			int viewIndex = jTable1.convertRowIndexToView(modelIndex);
			if (viewIndex < 0) {
				resetRoutineTableFilter();
				viewIndex = jTable1.convertRowIndexToView(modelIndex);
				if (viewIndex < 0) {
					modelIndex = ((RoutinesTableModel)jTable1.getModel()).getIndex(previousSelectedRtn);
					viewIndex = jTable1.convertRowIndexToView(modelIndex);
					jTable1.setRowSelectionInterval(viewIndex, viewIndex);
					JOptionPane.showMessageDialog(this, "The selected routine is blacklisted\nand cannot be displayed");
					return;
				}
			}
			jTable1.setRowSelectionInterval(viewIndex, viewIndex);
		}
	}//GEN-LAST:event_jList1MouseClicked

	private void jButton9ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton9ActionPerformed
		// Reload button
		try {
			File file = null;
			if (report == null) { // Reload last recent report
				ArrayList<File> r = Main.getRecentFiles();
				if (r.size() <= 0) return;
				file = r.get(0);
			} else { // Reload current report
				file = new File(this.report.getName());
			}
			loadReport(file);
			Main.addRecentFile(file);
			this.refreshRecentFiles();
		} catch (Exception e) {
			javax.swing.JOptionPane.showMessageDialog(this, 
					"Couldn't open the selected file", "Error",
					javax.swing.JOptionPane.ERROR_MESSAGE);
			//e.printStackTrace();
		}
		
	}//GEN-LAST:event_jButton9ActionPerformed

	private void formWindowOpened(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowOpened
		setExtendedState(MAXIMIZED_BOTH);
	}//GEN-LAST:event_formWindowOpened

	private void jMenuItem11ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem11ActionPerformed
		
		// Menu: File > Export > Routine profile 
		
		if (this.rtn_info == null) return;
		
		Iterator it = rtn_info.getInputTuplesIterator();
		try {
			
			File tmp = new File(this.report.getName() + "-"
								+ this.rtn_info.getName() + ".dat");
			
			JFileChooser chooser = new javax.swing.JFileChooser();
			String lastReportPath = Main.getLastReportPath();
			if (!lastReportPath.equals("")) 
				chooser.setCurrentDirectory(new File(lastReportPath));
			
			FileNameExtensionFilter filter = new FileNameExtensionFilter("Routine profile", "dat");
			chooser.setFileFilter(filter);
			chooser.setAcceptAllFileFilterUsed(false);
			chooser.setSelectedFile(tmp);
			int choice = chooser.showSaveDialog(this);
            
			if (choice == javax.swing.JFileChooser.APPROVE_OPTION) {
				
				tmp = chooser.getSelectedFile();
				tmp.createNewFile();
				PrintWriter out = new PrintWriter(new FileWriter(tmp));
                
                out.println("# RMS CUMUL_MIN CUMUL_MAX CUMUL_SUM "
                            + "REAL_SUM OCC SELF_SUM SELF_MIN SELF_MAX AM");
                
				while (it.hasNext()) {

					Rms s = (Rms) it.next();
					out.print(s.getRms() + " " + (int) s.getCumulativeMinCost() 
										+ " " + (int) s.getCumulativeMaxCost() 
										+ " " + (long) s.getTotalCumulativeCost()
                                        + " " + (long) s.getTotalRealCost()
										+ " " + (long)s.getOcc()
                                        + " " + (int) s.getSelfMinCost() 
										+ " " + (int) s.getSelfMaxCost() 
										+ " " + (long) s.getTotalSelfCost()
                              );
					out.format(" %.2f%n", rtn_info.getAmortizedValue(s.getRms()));

				}
				out.close();
			
			}
			
		} catch(java.io.IOException e) {
			
			JOptionPane.showMessageDialog(this, "Error during export :(",
					"Error", javax.swing.JOptionPane.ERROR_MESSAGE);
			
		}
		
	}//GEN-LAST:event_jMenuItem11ActionPerformed

	private void jMenuItem12ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem12ActionPerformed
		
		// Menu: File > Export > Program profile
		
		ArrayList<Routine> els = this.report.getRoutines();
		try {
			
			File tmp = new File(this.report.getName() + ".dat");
			
			JFileChooser chooser = new javax.swing.JFileChooser();
			String lastReportPath = Main.getLastReportPath();
			if (!lastReportPath.equals("")) 
				chooser.setCurrentDirectory(new File(lastReportPath));
			
			FileNameExtensionFilter filter = new FileNameExtensionFilter("Program profile", "dat");
			chooser.setFileFilter(filter);
			chooser.setAcceptAllFileFilterUsed(false);
			chooser.setSelectedFile(tmp);
			int choice = chooser.showSaveDialog(this.getParent());
			
			if (choice == javax.swing.JFileChooser.APPROVE_OPTION) {
				
				tmp = chooser.getSelectedFile();
				tmp.createNewFile();
				PrintWriter out = new PrintWriter(new FileWriter(tmp));
		
				for (int i = 0; i < els.size(); i++) {
					Routine el = els.get(i);
					out.println(el.getID() + " " +
								(long) el.getInputTuplesCount() + " " +
								(long) el.getTotalCost() + " " +
								(long) el.getTotalCalls() + " " +
								el.getName()
								);
				}
				out.close();
				
			}
			
		} catch(java.io.IOException e) {
			
			JOptionPane.showMessageDialog(this, "Error during export :(",
					"Error", javax.swing.JOptionPane.ERROR_MESSAGE);
		
		}
		
	}//GEN-LAST:event_jMenuItem12ActionPerformed

	private void jMenuItem13ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem13ActionPerformed
		
	}//GEN-LAST:event_jMenuItem13ActionPerformed

	private void jToggleButton10ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jToggleButton10ActionPerformed
		
		// Graph button
		if (jToggleButton10.isSelected()) {
			jPopupMenu1.show(jToggleButton10, 0, jToggleButton10.getHeight());
		} else {
			jPopupMenu1.setVisible(false);
		}
		
	}//GEN-LAST:event_jToggleButton10ActionPerformed

	private void jPopupMenu1PopupMenuWillBecomeInvisible(javax.swing.event.PopupMenuEvent evt) {//GEN-FIRST:event_jPopupMenu1PopupMenuWillBecomeInvisible
		
		jToggleButton10.setSelected(false);
		
	}//GEN-LAST:event_jPopupMenu1PopupMenuWillBecomeInvisible

	private void jCheckBoxMenuItem4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem4ActionPerformed
		
		// Graph menu button: cost plot
		if (jCheckBoxMenuItem4.isSelected()) addGraph(CostGraphPanel);
		else removeGraph(CostGraphPanel);
		
	}//GEN-LAST:event_jCheckBoxMenuItem4ActionPerformed

	private void jCheckBoxMenuItem5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem5ActionPerformed
		
		// Graph menu button: MMM plot
		if (jCheckBoxMenuItem5.isSelected()) addGraph(MMMGraphPanel);
		else removeGraph(MMMGraphPanel);
		
	}//GEN-LAST:event_jCheckBoxMenuItem5ActionPerformed

	private void jCheckBoxMenuItem6ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem6ActionPerformed
		
		// Graph menu button: total cost plot
		if (jCheckBoxMenuItem6.isSelected()) addGraph(TotalCostGraphPanel);
		else removeGraph(TotalCostGraphPanel);
		
	}//GEN-LAST:event_jCheckBoxMenuItem6ActionPerformed

	private void jCheckBoxMenuItem7ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem7ActionPerformed
		
		// Graph menu button: amortized plot
		if (jCheckBoxMenuItem7.isSelected()) addGraph(AmortizedGraphPanel);
		else removeGraph(AmortizedGraphPanel);
		
	}//GEN-LAST:event_jCheckBoxMenuItem7ActionPerformed

	private void jCheckBoxMenuItem8ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem8ActionPerformed
		
		// Graph menu button: ratio plot
		if (jCheckBoxMenuItem8.isSelected()) addGraph(ratioGraphPanel);
		else removeGraph(ratioGraphPanel);
		
	}//GEN-LAST:event_jCheckBoxMenuItem8ActionPerformed

	private void jCheckBoxMenuItem9ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem9ActionPerformed
		
		// Graph menu button: var plot
		if (jCheckBoxMenuItem9.isSelected()) addGraph(VarGraphPanel);
		else removeGraph(VarGraphPanel);
		
	}//GEN-LAST:event_jCheckBoxMenuItem9ActionPerformed

	private void jCheckBoxMenuItem10ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem10ActionPerformed
		
		// Graph menu button: freq plot
		if (jCheckBoxMenuItem10.isSelected()) addGraph(freqGraphPanel);
		else removeGraph(freqGraphPanel);
		
	}//GEN-LAST:event_jCheckBoxMenuItem10ActionPerformed

	private void jCheckBoxMenuItem12ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem12ActionPerformed
		
		// Graph menu button: cost plot
		if (jCheckBoxMenuItem12.isSelected()) addGraph(CostGraphPanel);
		else removeGraph(CostGraphPanel);
		
	}//GEN-LAST:event_jCheckBoxMenuItem12ActionPerformed

	private void jCheckBoxMenuItem13ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem13ActionPerformed
		
		// Graph menu button: MMM plot
		if (jCheckBoxMenuItem13.isSelected()) addGraph(MMMGraphPanel);
		else removeGraph(MMMGraphPanel);
		
	}//GEN-LAST:event_jCheckBoxMenuItem13ActionPerformed

	private void jCheckBoxMenuItem14ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem14ActionPerformed
		
		// Graph menu button: total cost plot
		if (jCheckBoxMenuItem14.isSelected()) addGraph(TotalCostGraphPanel);
		else removeGraph(TotalCostGraphPanel);
		
	}//GEN-LAST:event_jCheckBoxMenuItem14ActionPerformed

	private void jCheckBoxMenuItem15ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem15ActionPerformed
		
		// Graph menu button: amortized plot
		if (jCheckBoxMenuItem15.isSelected()) addGraph(AmortizedGraphPanel);
		else removeGraph(AmortizedGraphPanel);
		
	}//GEN-LAST:event_jCheckBoxMenuItem15ActionPerformed

	private void jCheckBoxMenuItem16ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem16ActionPerformed
		
		// Graph menu button: ratio plot
		if (jCheckBoxMenuItem16.isSelected()) addGraph(ratioGraphPanel);
		else removeGraph(ratioGraphPanel);
		
	}//GEN-LAST:event_jCheckBoxMenuItem16ActionPerformed

	private void jCheckBoxMenuItem17ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem17ActionPerformed
		
		// Graph menu button: var plot
		if (jCheckBoxMenuItem17.isSelected()) addGraph(VarGraphPanel);
		else removeGraph(VarGraphPanel);
		
	}//GEN-LAST:event_jCheckBoxMenuItem17ActionPerformed

	private void jCheckBoxMenuItem18ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem18ActionPerformed
		
		// Graph menu button: freq plot
		if (jCheckBoxMenuItem18.isSelected()) addGraph(freqGraphPanel);
		else removeGraph(freqGraphPanel);
		
	}//GEN-LAST:event_jCheckBoxMenuItem18ActionPerformed

	private void chooseSourceDirectory() {
	
		JFileChooser chooser = new JFileChooser();
		chooser.setDialogTitle("Set source code directory");
		chooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
		chooser.setAcceptAllFileFilterUsed(false);
		
		String lastSourceDir = Main.getLastSourceDir();
		if (!lastSourceDir.equals("")) 
			chooser.setCurrentDirectory((new java.io.File(lastSourceDir)));
		
		if (chooser.showOpenDialog(this) == JFileChooser.APPROVE_OPTION) {
			
			jProgressBar1.setVisible(true);
			jProgressBar1.setEnabled(true);
			loading = true;
			
			source_dir = chooser.getSelectedFile().getPath();
			Main.storeLastSourceDir(chooser.getSelectedFile().getPath());
			//System.out.println("Selected directory: " + source_dir);
			final ctagsParser c = new ctagsParser(chooser.getSelectedFile());
			
			SwingWorker worker = new SwingWorker<Boolean, Void>() {
			
				@Override
				public Boolean doInBackground() {
					
					sym = c.getSymbols();
					files = c.getFiles();
					jTextField2.setEnabled(true);
					jButton11.setEnabled(true);
					jProgressBar1.setVisible(false);
					jProgressBar1.setEnabled(false);
					jToggleButton2.setEnabled(true);
					loading = false;
					
					SwingUtilities.invokeLater(new Runnable() {
			
						@Override
						public void run() { 
							
							jComboBox1.setModel(new ListFilesEditorModel<String>(files));
							jComboBox1.setEnabled(true);

							if (!jLabel7.getText().equals("")) {
								//System.out.println("Function selected " + jLabel7.getText());
								loadFunctionInTextEditor(jLabel7.getText());
							} else {
								
								try {
									textArea.read(new StringReader(""),null);
								} catch (IOException ex) {
									//
								}
							
							}

						}
					});
					
					return true;
					
				}

			};
			worker.execute();
			
			//System.out.println("Collected " + l.size() + " symbols");
			
		}
		
	}
	
	private void jMenuItem8ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem8ActionPerformed

		chooseSourceDirectory();
		
	}//GEN-LAST:event_jMenuItem8ActionPerformed

	private void jButton10ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton10ActionPerformed
	
		chooseSourceDirectory();
		
	}//GEN-LAST:event_jButton10ActionPerformed

	private void jCheckBoxMenuItem1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem1ActionPerformed
		
		if (jCheckBoxMenuItem1.isSelected()) showTextEditor(true);
		else showTextEditor(false);
		
	}//GEN-LAST:event_jCheckBoxMenuItem1ActionPerformed

	private void jToggleButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jToggleButton1ActionPerformed

		
		if (jToggleButton4.isSelected()) {
			if (!editor_visible)
				showTextEditor(true);
			else
				showTextEditor(false);
		}
		
	}//GEN-LAST:event_jToggleButton1ActionPerformed

	private void jComboBox1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jComboBox1ActionPerformed
		
		if (loading) return;
		String file = (String) jComboBox1.getSelectedItem();
		//System.out.println(file);
		
		File f = new File(file);
		try {
			
			BufferedReader r = new BufferedReader(new FileReader(f));
			textArea.read(r, null);
			r.close();
		
		} catch (Exception ex) {
			//
		}
		
		if (highlight_line != null) textArea.removeLineHighlight(highlight_line);
		textArea.setCaretPosition(0);
		
	}//GEN-LAST:event_jComboBox1ActionPerformed

	private void jButton11ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton11ActionPerformed
		
		// Search routine in source code
		findRoutineByNameInSource();
				
	}//GEN-LAST:event_jButton11ActionPerformed

	private void jTextField2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField2ActionPerformed
		
		// Search routine in source code
		findRoutineByNameInSource();
		
	}//GEN-LAST:event_jTextField2ActionPerformed

	private void jToggleButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jToggleButton2ActionPerformed
		
		// Load function code selected in the routine table
		if (jToggleButton2.isSelected()) {
			linked_editor = true;
			if (!jLabel7.getText().equals(""))
				loadFunctionInTextEditor(jLabel7.getText());
		}
		else linked_editor = false;
		
	}//GEN-LAST:event_jToggleButton2ActionPerformed

    private void jTable1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTable1MouseClicked
        loading_routine = true;
        jTable1ValueChanged(null);
        loading_routine = false;
    }//GEN-LAST:event_jTable1MouseClicked

    private void jButton12ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton12ActionPerformed
        
        // Contexts filter button (corner contexts table)
		if (rtn_info != null) {
			ArrayList<String> liblist = null;
			liblist = report.getLibList();
			(new RoutinesFilterDialog(this, true, liblist, 
                    contexts_filter_criteria, false)).setVisible(true);
		}
    }//GEN-LAST:event_jButton12ActionPerformed

    private void jMenuItem14ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem14ActionPerformed
        
        // Menu: File > Export > Input volume...
		
        if (report == null) return;
        report.sortRoutinesByExternalInput();
        ArrayList<Routine> rr = report.getRoutines();
        
        try {
			
			File tmp = new File(this.report.getName() + "_input_volume.dat");
			
			JFileChooser chooser = new javax.swing.JFileChooser();
			String lastReportPath = Main.getLastReportPath();
			if (!lastReportPath.equals("")) 
				chooser.setCurrentDirectory(new File(lastReportPath));
			
			FileNameExtensionFilter filter = new FileNameExtensionFilter("Program profile", "dat");
			chooser.setFileFilter(filter);
			chooser.setAcceptAllFileFilterUsed(false);
			chooser.setSelectedFile(tmp);
			int choice = chooser.showSaveDialog(this.getParent());
			
			if (choice == javax.swing.JFileChooser.APPROVE_OPTION) {
				
				tmp = chooser.getSelectedFile();
				tmp.createNewFile();
				PrintWriter out = new PrintWriter(new FileWriter(tmp));
		
                out.format("# Percent Input_Volume*100 %n");
				for (int i = 0; i < rr.size(); i++) {
					
                    Routine r = rr.get(i);
                    double x = ((double)i + 1) / (((double)rr.size())/100);
                    double y = (1 - r.getRatioSumRmsRvms()) * 100;
                    
					out.format("%.1f %.1f%n", x, y);
				}
				out.close();
				
			}
			
		} catch(java.io.IOException e) {
			
			JOptionPane.showMessageDialog(this, "Error during export :(",
					"Error", javax.swing.JOptionPane.ERROR_MESSAGE);
		
		}
        
    }//GEN-LAST:event_jMenuItem14ActionPerformed

    private void jMenuItem15ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem15ActionPerformed
        
        // Menu: File > Export > profile routine richness...
		
        if (report == null) return;
        report.sortRoutinesByRatioTuples();
        ArrayList<Routine> rr = report.getRoutines();
        
        try {
			
			File tmp = new File(this.report.getName() + "_profile_richness.dat");
			
			JFileChooser chooser = new javax.swing.JFileChooser();
			String lastReportPath = Main.getLastReportPath();
			if (!lastReportPath.equals("")) 
				chooser.setCurrentDirectory(new File(lastReportPath));
			
			FileNameExtensionFilter filter = new FileNameExtensionFilter("Program profile", "dat");
			chooser.setFileFilter(filter);
			chooser.setAcceptAllFileFilterUsed(false);
			chooser.setSelectedFile(tmp);
			int choice = chooser.showSaveDialog(this.getParent());
			
			if (choice == javax.swing.JFileChooser.APPROVE_OPTION) {
				
				tmp = chooser.getSelectedFile();
				tmp.createNewFile();
				PrintWriter out = new PrintWriter(new FileWriter(tmp));
		
                out.format("# Percent Routine_Profile_Richness%n");
                //out.format("0 100%n");
				for (int i = 0; i < rr.size(); i++) {
					
                    Routine r = rr.get(i);
                    double x = ((double)i + 1) / (((double)rr.size())/100);
                    double y = r.getRatioRvmsRms() * 100;
                    
					out.format("%.1f %.1f%n", x, y);
				}
				out.close();
				
			}
			
		} catch(java.io.IOException e) {
			
			JOptionPane.showMessageDialog(this, "Error during export :(",
					"Error", javax.swing.JOptionPane.ERROR_MESSAGE);
		
		}
    }//GEN-LAST:event_jMenuItem15ActionPerformed

    private void jMenuItem16ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem16ActionPerformed
        
        // Menu: File > Export > thread input...
		
        if (report == null) return;
        report.sortRoutinesByThreadInput();
        ArrayList<Routine> rr = report.getRoutines();
        
        try {
			
			File tmp = new File(this.report.getName() + "_thread_input.dat");
			
			JFileChooser chooser = new javax.swing.JFileChooser();
			String lastReportPath = Main.getLastReportPath();
			if (!lastReportPath.equals("")) 
				chooser.setCurrentDirectory(new File(lastReportPath));
			
			FileNameExtensionFilter filter = new FileNameExtensionFilter("Program profile", "dat");
			chooser.setFileFilter(filter);
			chooser.setAcceptAllFileFilterUsed(false);
			chooser.setSelectedFile(tmp);
			int choice = chooser.showSaveDialog(this.getParent());
			
			if (choice == javax.swing.JFileChooser.APPROVE_OPTION) {
				
				tmp = chooser.getSelectedFile();
				tmp.createNewFile();
				PrintWriter out = new PrintWriter(new FileWriter(tmp));
		
                out.format("# Percent Thread_Input%n");
                out.format("0 100%n");
				for (int i = 0; i < rr.size(); i++) {
					
                    Routine r = rr.get(i);
                    double x = ((double)i + 1) / (((double)rr.size())/100);
                    double y = r.getRatioThreadInput() * 100;
                    
					out.format("%.1f %.1f%n", x, y);
				}
				out.close();
				
			}
			
		} catch(java.io.IOException e) {
			
			JOptionPane.showMessageDialog(this, "Error during export :(",
					"Error", javax.swing.JOptionPane.ERROR_MESSAGE);
		
		}
    }//GEN-LAST:event_jMenuItem16ActionPerformed

    private void extractInputStats() {                                            
        
        
    } 
    
    private void jMenuItem17ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem17ActionPerformed
        
        // Menu: File > Export > external input...
		
        if (report == null) return;
        report.sortRoutinesBySyscallInput();
        ArrayList<Routine> rr = report.getRoutines();
        
        try {
			
			File tmp = new File(this.report.getName() + "_external_input.dat");
			
			JFileChooser chooser = new javax.swing.JFileChooser();
			String lastReportPath = Main.getLastReportPath();
			if (!lastReportPath.equals("")) 
				chooser.setCurrentDirectory(new File(lastReportPath));
			
			FileNameExtensionFilter filter = new FileNameExtensionFilter("Program profile", "dat");
			chooser.setFileFilter(filter);
			chooser.setAcceptAllFileFilterUsed(false);
			chooser.setSelectedFile(tmp);
			int choice = chooser.showSaveDialog(this.getParent());
			
			if (choice == javax.swing.JFileChooser.APPROVE_OPTION) {
				
				tmp = chooser.getSelectedFile();
				tmp.createNewFile();
				PrintWriter out = new PrintWriter(new FileWriter(tmp));
		
                out.format("# Percent External_input%n");
                out.format("0 100%n");
				for (int i = 0; i < rr.size(); i++) {
					
                    Routine r = rr.get(i);
                    double x = ((double)i + 1) / (((double)rr.size())/100);
                    double y =  r.getRatioSyscallInput() * 100;
                    
					out.format("%.1f %.1f%n", x, y);
				}
				out.close();
				
			}
			
		} catch(java.io.IOException e) {
			
			JOptionPane.showMessageDialog(this, "Error during export :(",
					"Error", javax.swing.JOptionPane.ERROR_MESSAGE);
		
		}
    }//GEN-LAST:event_jMenuItem17ActionPerformed

    private void jMenuItem18ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem18ActionPerformed
        
        this.jMenuItem14ActionPerformed(evt);
        this.jMenuItem15ActionPerformed(evt);
        this.jMenuItem16ActionPerformed(evt);
        this.jMenuItem17ActionPerformed(evt);
        this.jMenuItem19ActionPerformed(evt);
        
    }//GEN-LAST:event_jMenuItem18ActionPerformed

    private void jMenuItem19ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem19ActionPerformed
        
        // Menu: File > Export > induced accesses...
		
        if (report == null) return;
        report.sortRoutinesByDynamicInput();
        ArrayList<Routine> rr = report.getRoutines();
        
        try {
			
			File tmp = new File(this.report.getName() + "_induced_accesses.dat");
			
			JFileChooser chooser = new javax.swing.JFileChooser();
			String lastReportPath = Main.getLastReportPath();
			if (!lastReportPath.equals("")) 
				chooser.setCurrentDirectory(new File(lastReportPath));
			
			FileNameExtensionFilter filter = new FileNameExtensionFilter("Program profile", "dat");
			chooser.setFileFilter(filter);
			chooser.setAcceptAllFileFilterUsed(false);
			chooser.setSelectedFile(tmp);
			int choice = chooser.showSaveDialog(this.getParent());
			
			if (choice == javax.swing.JFileChooser.APPROVE_OPTION) {
				
				tmp = chooser.getSelectedFile();
				tmp.createNewFile();
				PrintWriter out = new PrintWriter(new FileWriter(tmp));
		
                out.format("# Percent External_input Thread_input%n");
                
                int k = 1;
				for (int i = 0; i < rr.size(); i++) {
                    
                    Routine r = rr.get(i);
                    if (r.getInputTuplesCount() < 5) continue;
                    /*
                    System.out.println("Routine " 
                            + i + " tuples " + r.getSizeRmsList());
                    
                    */
                    double x = k++;
                    double y =  r.getRatioSyscallInput() * 100;
                    double z =  r.getRatioThreadInput() * 100;
                    
					out.format("%.1f %.1f %.1f%n", x, y, z);
				}
				out.close();
				
			}
			
		} catch(java.io.IOException e) {
			
			JOptionPane.showMessageDialog(this, "Error during export :(",
					"Error", javax.swing.JOptionPane.ERROR_MESSAGE);
		
		}
        
    }//GEN-LAST:event_jMenuItem19ActionPerformed

    private void jMenuItem20ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem20ActionPerformed

        // Menu: File > Export > self induced accesses...
		
        if (report == null) return;
        
        try {
			
			File tmp = new File(this.report.getName() + "_self_induced_accesses.dat");
			
			JFileChooser chooser = new javax.swing.JFileChooser();
			String lastReportPath = Main.getLastReportPath();
			if (!lastReportPath.equals("")) 
				chooser.setCurrentDirectory(new File(lastReportPath));
			
			FileNameExtensionFilter filter = new FileNameExtensionFilter("Program profile", "dat");
			chooser.setFileFilter(filter);
			chooser.setAcceptAllFileFilterUsed(false);
			chooser.setSelectedFile(tmp);
			int choice = chooser.showSaveDialog(this.getParent());
			
			if (choice == javax.swing.JFileChooser.APPROVE_OPTION) {
				
				tmp = chooser.getSelectedFile();
				tmp.createNewFile();
				PrintWriter out = new PrintWriter(new FileWriter(tmp));
		
                out.format("#Self_External_input Self_Thread_input%n");
                
                out.println(report.getTotalSelfSyscallInput() + " " +
                                    report.getTotalSelfThreadInput());
                
                double x = report.getTotalSelfSyscallInput() + report.getTotalSelfThreadInput();
                double y = (report.getTotalSelfSyscallInput() / x) * 100;
                double z = (report.getTotalSelfThreadInput() / x) * 100;
                
                out.format("%.1f %.1f%n", y, z);
                
				out.close();
				
			}
			
		} catch(java.io.IOException e) {
			
			JOptionPane.showMessageDialog(this, "Error during export :(",
					"Error", javax.swing.JOptionPane.ERROR_MESSAGE);
		
		}
    }//GEN-LAST:event_jMenuItem20ActionPerformed

    private void jCheckBoxMenuItem24ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem24ActionPerformed
        
        // Alpha plot checkbox (menubar)
        if (jCheckBoxMenuItem24.isSelected()) addGraph(AlphaGraphPanel);
		else removeGraph(AlphaGraphPanel);
        
    }//GEN-LAST:event_jCheckBoxMenuItem24ActionPerformed

    private void jCheckBoxMenuItem25ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxMenuItem25ActionPerformed
        
        // Alpha plot checkbox (toolbar)
        if (jCheckBoxMenuItem25.isSelected()) addGraph(AlphaGraphPanel);
		else removeGraph(AlphaGraphPanel);
    }//GEN-LAST:event_jCheckBoxMenuItem25ActionPerformed

    private void jMenuItem21ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem21ActionPerformed
        
        // Menu: File > Export > alpha values
		
        if (report == null || rtn_info == null) return;
        
        try {
			
			File tmp = new File(this.report.getName() + "_alpha.dat");
			
			JFileChooser chooser = new javax.swing.JFileChooser();
			String lastReportPath = Main.getLastReportPath();
			if (!lastReportPath.equals("")) 
				chooser.setCurrentDirectory(new File(lastReportPath));
			
			FileNameExtensionFilter filter = new FileNameExtensionFilter("Alpha values", "dat");
			chooser.setFileFilter(filter);
			chooser.setAcceptAllFileFilterUsed(false);
			chooser.setSelectedFile(tmp);
			int choice = chooser.showSaveDialog(this.getParent());
			
			if (choice == javax.swing.JFileChooser.APPROVE_OPTION) {
				
				tmp = chooser.getSelectedFile();
				tmp.createNewFile();
				PrintWriter out = new PrintWriter(new FileWriter(tmp));
		
                out.format("# alpha points %n");
                
                ArrayList<Double> list = rtn_info.estimateAmortizedConstant();
                for (int i = 0; i < list.size(); i += 2)
                    out.format("%.3f %.0f%n", list.get(i), list.get(i+1));
                
				out.close();
				
			}
			
		} catch(java.io.IOException e) {
			
			JOptionPane.showMessageDialog(this, "Error during export :(",
					"Error", javax.swing.JOptionPane.ERROR_MESSAGE);
		
		}
    }//GEN-LAST:event_jMenuItem21ActionPerformed

	private void resetRoutineTableFilter() {
		
		// reset filter over routine table
		routines_filter_criteria = new String[4];
		routines_filter_criteria[0] = null;
		routines_filter_criteria[1] = null;
		routines_filter_criteria[2] = null;
		routines_filter_criteria[3] = "5";
		refreshRoutinesTableFilter();
		
	}
    
    private void resetContextsTableFilter() {
		
		// reset filter over routine table
		contexts_filter_criteria = new String[4];
		contexts_filter_criteria[0] = null;
		contexts_filter_criteria[1] = null;
		contexts_filter_criteria[2] = null;
		contexts_filter_criteria[3] = "5";
		refreshContextsTableFilter();
		
	}

	protected void refreshRoutinesTableFilter() {
		setRoutinesTableFilter(routines_filter_criteria);
	}

    protected void refreshContextsTableFilter() {
		setContextsTableFilter(contexts_filter_criteria);
	}
    
	protected void setRoutinesTableFilter(String[] criteria) {
		
		routines_filter_criteria = criteria;
		java.util.ArrayList<String> blacklist = Main.getBlackList();
		
		List<RowFilter<TableModel, Integer>> filters = new ArrayList<RowFilter<TableModel, Integer>>(4);
		
		// Filtering based on blacklist
		if (Main.getBlackListEnabled() && blacklist.size() > 0) {
			
			List<RowFilter<TableModel,Integer>> blacklist_filters = new ArrayList<RowFilter<TableModel,Integer>>();
			for (int i = 0; i < blacklist.size(); i++) {
				
				RowFilter<TableModel, Integer> blacklist_filter = null;
				try {
					blacklist_filter = RowFilter.regexFilter(blacklist.get(i).replace(".", "\\."), 0);
				} catch (java.util.regex.PatternSyntaxException e) {
					return;
				}
				blacklist_filters.add(RowFilter.notFilter(blacklist_filter));
			}
			
			RowFilter<TableModel, Integer> f = RowFilter.andFilter(blacklist_filters);
			filters.add(f);
		}
		
		// Filtering based on % time
		if (criteria[0] != null) {
			
			List<RowFilter<TableModel,Integer>> timeperc_filters = new ArrayList<RowFilter<TableModel,Integer>>(2);
			RowFilter<TableModel, Integer> timeperc_equal_filter = null;
			RowFilter<TableModel, Integer> timeperc_greater_filter = null;
			try {
				timeperc_equal_filter = RowFilter.numberFilter(RowFilter.ComparisonType.EQUAL, new Double(Double.parseDouble(criteria[0])), 4);
				timeperc_greater_filter = RowFilter.numberFilter(RowFilter.ComparisonType.AFTER, new Double(Double.parseDouble(criteria[0])), 4);
			} catch (java.util.regex.PatternSyntaxException e) {
				return;
			}
			timeperc_filters.add(timeperc_equal_filter);
			timeperc_filters.add(timeperc_greater_filter);
			RowFilter<TableModel, Integer> f = javax.swing.RowFilter.orFilter(timeperc_filters);
			filters.add(f);
		}
		
		// Filtering based on library name
		if (criteria[1] != null) {
			
			List<RowFilter<TableModel,Integer>> lib_filters = new ArrayList<RowFilter<TableModel,Integer>>(1);
			RowFilter<TableModel, Integer> lib_filter = null;
			try {
				lib_filter = javax.swing.RowFilter.regexFilter(criteria[1], 1);
			} catch (java.util.regex.PatternSyntaxException e) {
				return;
			}
			lib_filters.add(lib_filter);
			RowFilter<TableModel, Integer> f4 = RowFilter.andFilter(lib_filters);
			filters.add(f4);
		}
		
		// Filtering based on % of calls
		if (criteria[2] != null) {
			
			List<RowFilter<TableModel,Integer>> callsperc_filters = new ArrayList<RowFilter<TableModel,Integer>>(2);
			javax.swing.RowFilter<TableModel, Integer> callsperc_equal_filter = null;
			javax.swing.RowFilter<TableModel, Integer> callsperc_greater_filter = null;
			try {
				
				callsperc_equal_filter = RowFilter.numberFilter(RowFilter.ComparisonType.EQUAL, new Double(Double.parseDouble(criteria[2])), 7);
				callsperc_greater_filter = RowFilter.numberFilter(RowFilter.ComparisonType.AFTER, new Double(Double.parseDouble(criteria[2])), 7);
			
			} catch (java.util.regex.PatternSyntaxException e) {
				return;
			}
			callsperc_filters.add(callsperc_equal_filter);
			callsperc_filters.add(callsperc_greater_filter);
			RowFilter<TableModel, Integer> f5 = RowFilter.orFilter(callsperc_filters);
			filters.add(f5);
		}
		
		// Filtering based on # rms
		if (criteria[3] != null) {
			
			List<RowFilter<TableModel,Integer>> avgratio_filters = new ArrayList<RowFilter<TableModel,Integer>>(2);
			RowFilter<TableModel, Integer> avgratio_equal_filter = null;
			RowFilter<TableModel, Integer> avgratio_greater_filter = null;
			try {
				
				avgratio_equal_filter = RowFilter.numberFilter(RowFilter.ComparisonType.EQUAL, new Double(Double.parseDouble(criteria[3])), 3);
				avgratio_greater_filter = RowFilter.numberFilter(RowFilter.ComparisonType.AFTER, new Double(Double.parseDouble(criteria[3])), 3);
			
			} catch (java.util.regex.PatternSyntaxException e) {
				return;
			}
			avgratio_filters.add(avgratio_equal_filter);
			avgratio_filters.add(avgratio_greater_filter);
			RowFilter<TableModel, Integer> f6 = RowFilter.orFilter(avgratio_filters);
			filters.add(f6);
		}

		routines_table_sorter.setRowFilter(RowFilter.andFilter(filters));
	}

    protected void setContextsTableFilter(String[] criteria) {
		
		contexts_filter_criteria = criteria;
		java.util.ArrayList<String> blacklist = Main.getBlackList();
		
		List<RowFilter<TableModel, Integer>> filters = new ArrayList<RowFilter<TableModel, Integer>>(4);
		
		// Filtering based on blacklist
		if (Main.getBlackListEnabled() && blacklist.size() > 0) {
			
			List<RowFilter<TableModel,Integer>> blacklist_filters = new ArrayList<RowFilter<TableModel,Integer>>();
			for (int i = 0; i < blacklist.size(); i++) {
				
				RowFilter<TableModel, Integer> blacklist_filter = null;
				try {
					blacklist_filter = RowFilter.regexFilter(blacklist.get(i).replace(".", "\\."), 0);
				} catch (java.util.regex.PatternSyntaxException e) {
					return;
				}
				blacklist_filters.add(RowFilter.notFilter(blacklist_filter));
			}
			
			RowFilter<TableModel, Integer> f = RowFilter.andFilter(blacklist_filters);
			filters.add(f);
		}
		
		// Filtering based on % time
		if (criteria[0] != null) {
			
			List<RowFilter<TableModel,Integer>> timeperc_filters = new ArrayList<RowFilter<TableModel,Integer>>(2);
			RowFilter<TableModel, Integer> timeperc_equal_filter = null;
			RowFilter<TableModel, Integer> timeperc_greater_filter = null;
			try {
				timeperc_equal_filter = RowFilter.numberFilter(RowFilter.ComparisonType.EQUAL, new Double(Double.parseDouble(criteria[0])), 4);
				timeperc_greater_filter = RowFilter.numberFilter(RowFilter.ComparisonType.AFTER, new Double(Double.parseDouble(criteria[0])), 4);
			} catch (java.util.regex.PatternSyntaxException e) {
				return;
			}
			timeperc_filters.add(timeperc_equal_filter);
			timeperc_filters.add(timeperc_greater_filter);
			RowFilter<TableModel, Integer> f = javax.swing.RowFilter.orFilter(timeperc_filters);
			filters.add(f);
		}
		
		// Filtering based on library name
		if (criteria[1] != null) {
			
			List<RowFilter<TableModel,Integer>> lib_filters = new ArrayList<RowFilter<TableModel,Integer>>(1);
			RowFilter<TableModel, Integer> lib_filter = null;
			try {
				lib_filter = javax.swing.RowFilter.regexFilter(criteria[1], 1);
			} catch (java.util.regex.PatternSyntaxException e) {
				return;
			}
			lib_filters.add(lib_filter);
			RowFilter<TableModel, Integer> f4 = RowFilter.andFilter(lib_filters);
			filters.add(f4);
		}
		
		// Filtering based on % of calls
		if (criteria[2] != null) {
			
			List<RowFilter<TableModel,Integer>> callsperc_filters = new ArrayList<RowFilter<TableModel,Integer>>(2);
			javax.swing.RowFilter<TableModel, Integer> callsperc_equal_filter = null;
			javax.swing.RowFilter<TableModel, Integer> callsperc_greater_filter = null;
			try {
				
				callsperc_equal_filter = RowFilter.numberFilter(RowFilter.ComparisonType.EQUAL, new Double(Double.parseDouble(criteria[2])), 7);
				callsperc_greater_filter = RowFilter.numberFilter(RowFilter.ComparisonType.AFTER, new Double(Double.parseDouble(criteria[2])), 7);
			
			} catch (java.util.regex.PatternSyntaxException e) {
				return;
			}
			callsperc_filters.add(callsperc_equal_filter);
			callsperc_filters.add(callsperc_greater_filter);
			RowFilter<TableModel, Integer> f5 = RowFilter.orFilter(callsperc_filters);
			filters.add(f5);
		}
		
		// Filtering based on # rms
		if (criteria[3] != null) {
			
			List<RowFilter<TableModel,Integer>> avgratio_filters = new ArrayList<RowFilter<TableModel,Integer>>(2);
			RowFilter<TableModel, Integer> avgratio_equal_filter = null;
			RowFilter<TableModel, Integer> avgratio_greater_filter = null;
			try {
				
				avgratio_equal_filter = RowFilter.numberFilter(RowFilter.ComparisonType.EQUAL, new Double(Double.parseDouble(criteria[3])), 3);
				avgratio_greater_filter = RowFilter.numberFilter(RowFilter.ComparisonType.AFTER, new Double(Double.parseDouble(criteria[3])), 3);
			
			} catch (java.util.regex.PatternSyntaxException e) {
				return;
			}
			avgratio_filters.add(avgratio_equal_filter);
			avgratio_filters.add(avgratio_greater_filter);
			RowFilter<TableModel, Integer> f6 = RowFilter.orFilter(avgratio_filters);
			filters.add(f6);
		}
        
        
        contexts_table_sorter.setRowFilter(RowFilter.andFilter(filters));
        
    }
    
	protected String[] getRmsTableFilter() {
		return rms_filter_criteria;
	}

	private void refreshPlotFilter() {
		if (CostGraphPanel != null) CostGraphPanel.refreshFilter();
		if (ratioGraphPanel != null) ratioGraphPanel.refreshFilter();
		if (freqGraphPanel != null) freqGraphPanel.refreshFilter();
		if (MMMGraphPanel != null) MMMGraphPanel.refreshFilter();
		if (TotalCostGraphPanel != null) TotalCostGraphPanel.refreshFilter();
		if (VarGraphPanel != null) VarGraphPanel.refreshFilter();
		if (RtnGraphPanel != null) RtnGraphPanel.refreshFilter();
        if (RatioTuplesGraphPanel != null) RatioTuplesGraphPanel.refreshFilter();
        if (ExternalInputGraphPanel != null) ExternalInputGraphPanel.refreshFilter();
		if (AmortizedGraphPanel != null) AmortizedGraphPanel.refreshFilter();
	}

    protected void refreshRmsTableFilter() {
		setRmsTableFilter(rms_filter_criteria);
	}
    
	protected void setRmsTableFilter(String[] criteria) {
		
		this.rms_filter_criteria = criteria;
		refreshPlotFilter();
		if (criteria == null) rms_table_sorter.setRowFilter(null); // no filters
		
		ArrayList<RowFilter<TableModel, Integer>> filters = new ArrayList<RowFilter<TableModel, Integer>>(3);
		if (criteria[0] != null) {
		
			List<javax.swing.RowFilter<javax.swing.table.TableModel,Integer>> time_filters = new java.util.ArrayList<javax.swing.RowFilter<javax.swing.table.TableModel,Integer>>(2);
			RowFilter<javax.swing.table.TableModel, Integer> time_equal_filter = null;
			RowFilter<javax.swing.table.TableModel, Integer> time_greater_filter = null;
			try {
				time_equal_filter = RowFilter.numberFilter(RowFilter.ComparisonType.EQUAL, new Double(Double.parseDouble(criteria[0])), 3);
				time_greater_filter = RowFilter.numberFilter(RowFilter.ComparisonType.AFTER, new Double(Double.parseDouble(criteria[0])), 3);
			} catch (java.util.regex.PatternSyntaxException e) {
				return;
			}
			time_filters.add(time_equal_filter);
			time_filters.add(time_greater_filter);
			RowFilter<TableModel, Integer> f = RowFilter.orFilter(time_filters);
			filters.add(f);
		
		}
		if (criteria[1] != null) {
			
			List<javax.swing.RowFilter<TableModel,Integer>> ratio_filters = new ArrayList<RowFilter<TableModel,Integer>>(2);
			RowFilter<TableModel, Integer> rms_equal_filter = null;
			RowFilter<TableModel, Integer> rms_greater_filter = null;
			try {
				rms_equal_filter = javax.swing.RowFilter.numberFilter(javax.swing.RowFilter.ComparisonType.EQUAL, new Double(Double.parseDouble(criteria[1])), 0);
				rms_greater_filter = javax.swing.RowFilter.numberFilter(javax.swing.RowFilter.ComparisonType.AFTER, new Double(Double.parseDouble(criteria[1])), 0);
			} catch (java.util.regex.PatternSyntaxException e) {
				return;
			}
			ratio_filters.add(rms_equal_filter);
			ratio_filters.add(rms_greater_filter);
			RowFilter<TableModel, Integer> f = RowFilter.orFilter(ratio_filters);
			filters.add(f);
		}
		if (criteria[2] != null) {
			List<RowFilter<TableModel,Integer>> freq_filters = new ArrayList<RowFilter<TableModel,Integer>>(2);
			RowFilter<TableModel, Integer> freq_equal_filter = null;
			RowFilter<TableModel, Integer> freq_greater_filter = null;
			try {
				freq_equal_filter = RowFilter.numberFilter(RowFilter.ComparisonType.EQUAL, new Double(Double.parseDouble(criteria[2])), 4);
				freq_greater_filter = RowFilter.numberFilter(RowFilter.ComparisonType.AFTER, new Double(Double.parseDouble(criteria[2])), 4);
			} catch (java.util.regex.PatternSyntaxException e) {
				return;
			}
			freq_filters.add(freq_equal_filter);
			freq_filters.add(freq_greater_filter);
			RowFilter<TableModel, Integer> f = RowFilter.orFilter(freq_filters);
			filters.add(f);
		}
		rms_table_sorter.setRowFilter(javax.swing.RowFilter.andFilter(filters));
	}

	private void findRoutineByName() {
		String query = jTextField1.getText().toLowerCase();
		if (jTable1.getRowCount() > 0 && !query.equals("")) {
			int i = jTable1.getSelectedRow();
			if (i < 0) i = 0;
			int size = jTable1.getRowCount();
			i++;
			if (i >= size) i = 0;
			int start = i;
			while (true) {
				Routine rtn = ((RoutinesTableModel)jTable1.getModel()).getRoutine(jTable1.convertRowIndexToModel(i));
				if (rtn.getName().toLowerCase().contains(query)) {
					jTable1.setRowSelectionInterval(i,i);
					if (jTable1.getParent() instanceof javax.swing.JViewport) { // Scroll to visible; thanks to fiontan
						javax.swing.JViewport viewport = (javax.swing.JViewport)jTable1.getParent();
						java.awt.Rectangle rect = jTable1.getCellRect(i, 0, true);
						java.awt.Point pos = viewport.getViewPosition();
						rect.translate(-pos.x, -pos.y);
						viewport.scrollRectToVisible(rect);
					}
					return;
				}
				i++;
				if (i >= size) i = 0;
				if (i == start) {
					//not found
					javax.swing.JOptionPane.showMessageDialog(this, "text not found");
					return;
				}
			}
		}
	}
	
	private void findRoutineByNameInSource() {
		
		if (sym == null) return;
		String query = jTextField2.getText().toLowerCase();
		
		if (query.equals("")) return;
		
		Set s = sym.keySet();
		Object[] a = s.toArray();
		int index = source_index;
		
		//System.out.println(source_index);
		
		while(index < a.length) {
		
			String name = (String) a[index++];
			if (name.toLowerCase().contains(query)) {
				source_index = index;
				loadFunctionInTextEditor(name);
				return;
			}
		
		}
		
		if (source_index > 0) {
			
			index = 0;
			while(index < a.length && index < source_index) {
		
				String name = (String) a[index++];
				if (name.contains(query)) {
					source_index = index;
					loadFunctionInTextEditor(name);
					return;
				}

			}
			source_index = 0;
				
		}
		
		javax.swing.JOptionPane.showMessageDialog(this, "text not found");
	
	}
	
	private void initGraph() {
		
		// Init graphs:
		CostGraphPanel = new GraphPanel(GraphPanel.COST_PLOT, this);
		ratioGraphPanel = new GraphPanel(GraphPanel.RATIO_PLOT, this);
		freqGraphPanel = new GraphPanel(GraphPanel.FREQ_PLOT, this);
		MMMGraphPanel = new GraphPanel(GraphPanel.MMM_PLOT, this);
		TotalCostGraphPanel = new GraphPanel(GraphPanel.TOTALCOST_PLOT, this);
		VarGraphPanel = new GraphPanel(GraphPanel.VAR_PLOT, this);
		RtnGraphPanel = new GraphPanel(GraphPanel.RTN_PLOT, this);
		AmortizedGraphPanel = new GraphPanel(GraphPanel.AMORTIZED_PLOT, this);
        RatioTuplesGraphPanel = new GraphPanel(GraphPanel.RATIO_TUPLES_PLOT, this);
        ExternalInputGraphPanel = new GraphPanel(GraphPanel.EXTERNAL_INPUT_PLOT, this);
		AlphaGraphPanel = new GraphPanel(GraphPanel.ALPHA_PLOT, this);
        
		// Set performance monitor
		CostGraphPanel.setPerformanceMonitor(perf);
		ratioGraphPanel.setPerformanceMonitor(perf);
		freqGraphPanel.setPerformanceMonitor(perf);
		MMMGraphPanel.setPerformanceMonitor(perf);
		TotalCostGraphPanel.setPerformanceMonitor(perf);
		VarGraphPanel.setPerformanceMonitor(perf);
		RtnGraphPanel.setPerformanceMonitor(perf);
		AmortizedGraphPanel.setPerformanceMonitor(perf);
		RatioTuplesGraphPanel.setPerformanceMonitor(perf);
        ExternalInputGraphPanel.setPerformanceMonitor(perf);
        AlphaGraphPanel.setPerformanceMonitor(perf);
        
		ArrayList<Integer> graph_order = Main.getGraphOrder();
		// Reset graph order (addGraph will set this later)
		Main.setGraphOrder(new ArrayList<Integer>());
		for (int i = 0; i < graph_order.size(); i++) {
		
			int graph_type = graph_order.get(i);
			GraphPanel g = null;
			
			switch(graph_type) {
				
				case GraphPanel.COST_PLOT:
					g = CostGraphPanel;
					break;
					
				case GraphPanel.RATIO_PLOT:
					g = ratioGraphPanel;
					break;
					
				case GraphPanel.FREQ_PLOT:
					g = freqGraphPanel;
					break;
					
				case GraphPanel.MMM_PLOT:
					g = MMMGraphPanel;
					break;
					
				case GraphPanel.TOTALCOST_PLOT:
					g = TotalCostGraphPanel;
					break;
			
				case GraphPanel.VAR_PLOT:
					g = VarGraphPanel;
					break;
					
				case GraphPanel.RTN_PLOT:
					g = RtnGraphPanel;
					break;
					
				case GraphPanel.AMORTIZED_PLOT:
					g = AmortizedGraphPanel;
					break;
					
                case GraphPanel.RATIO_TUPLES_PLOT:
                    g = RatioTuplesGraphPanel;
                    break;
                    
                case GraphPanel.EXTERNAL_INPUT_PLOT:
                    g = ExternalInputGraphPanel;
                    break;
                
                case GraphPanel.ALPHA_PLOT:
                    g = AlphaGraphPanel;
                    break;
                    
				default:
					System.out.println("Invalid graph type");
					throw new RuntimeException("Invalid graph type");
				
			}
			
			addGraph(g);
		
		}
		
	
	}
	
	private void addGraph(GraphPanel g) {
		
		if (g == null) return;
		
		switch(g.getGraphType()) {
			
			case GraphPanel.COST_PLOT:
				jCheckBoxMenuItem4.setSelected(true);
				jCheckBoxMenuItem12.setSelected(true);
				break;
				
			case GraphPanel.MMM_PLOT:
				jCheckBoxMenuItem5.setSelected(true);
				jCheckBoxMenuItem13.setSelected(true);
				break;
				
			case GraphPanel.TOTALCOST_PLOT:
				jCheckBoxMenuItem6.setSelected(true);
				jCheckBoxMenuItem14.setSelected(true);
				break;
			
			case GraphPanel.AMORTIZED_PLOT:
				jCheckBoxMenuItem7.setSelected(true);
				jCheckBoxMenuItem15.setSelected(true);
				break;
				
			case GraphPanel.RATIO_PLOT:
				jCheckBoxMenuItem8.setSelected(true);
				jCheckBoxMenuItem16.setSelected(true);
				break;
				
			case GraphPanel.VAR_PLOT:
				jCheckBoxMenuItem9.setSelected(true);
				jCheckBoxMenuItem17.setSelected(true);
				break;
				
			case GraphPanel.FREQ_PLOT:
				jCheckBoxMenuItem10.setSelected(true);
				jCheckBoxMenuItem18.setSelected(true);
				break;
			/*	
			case GraphPanel.RTN_PLOT:
				jCheckBoxMenuItem11.setSelected(true);
				jCheckBoxMenuItem19.setSelected(true);
				break;
                
            case GraphPanel.RATIO_TUPLES_PLOT:
                jCheckBoxMenuItem20.setSelected(true);
                jCheckBoxMenuItem22.setSelected(true);
                break;
                
            case GraphPanel.EXTERNAL_INPUT_PLOT:
                jCheckBoxMenuItem21.setSelected(true);
                jCheckBoxMenuItem23.setSelected(true);
                break;
            */
            case GraphPanel.ALPHA_PLOT:
                jCheckBoxMenuItem25.setSelected(true);
                jCheckBoxMenuItem24.setSelected(true);
                break;
				
		}
		
		graph_visible++;
		
		ArrayList<Integer> go = Main.getGraphOrder();
		
		if (append_graph) {
		
			jPanel9.add(g);
			go.add(g.getGraphType());	
		
		} else {
			
			Component[] l = jPanel9.getComponents();
			int i = 0;
			for(i = 0; i < l.length; i++) {
				
				if (!(l[i] instanceof GraphPanel)) continue; 
				GraphPanel cg = (GraphPanel) l[i];
				if (cg.getGraphPriority() > g.getGraphPriority()) break;
				
			}
			
			if (i >= l.length) jPanel9.add(g);
			else jPanel9.add(g, i);
			
			// Update graph order
			if (i >= go.size()) go.add(g.getGraphType());
			else go.add(i, g.getGraphType());
		
		}
		
		
		g.setVisible(true);
		g.setData(this.rtn_info);
		Main.setGraphOrder(go);
		adjustGraphLayout();

	}

	private void removeGraph(GraphPanel g) {
		
		if (g == null) return;
		
		switch(g.getGraphType()) {
			
			case GraphPanel.COST_PLOT:
				jPanel9.remove(g);
				jCheckBoxMenuItem4.setSelected(false);
				jCheckBoxMenuItem12.setSelected(false);
				break;
				
			case GraphPanel.MMM_PLOT:
				jCheckBoxMenuItem5.setSelected(false);
				jCheckBoxMenuItem13.setSelected(false);
				break;
				
			case GraphPanel.TOTALCOST_PLOT:
				jCheckBoxMenuItem6.setSelected(false);
				jCheckBoxMenuItem14.setSelected(false);
				break;
			
			case GraphPanel.AMORTIZED_PLOT:
				jCheckBoxMenuItem7.setSelected(false);
				jCheckBoxMenuItem15.setSelected(false);
				break;
				
			case GraphPanel.RATIO_PLOT:
				jCheckBoxMenuItem6.setSelected(false);
				jCheckBoxMenuItem16.setSelected(false);
				break;
				
			case GraphPanel.VAR_PLOT:
				jCheckBoxMenuItem9.setSelected(false);
				jCheckBoxMenuItem17.setSelected(false);
				break;
				
			case GraphPanel.FREQ_PLOT:
				jCheckBoxMenuItem10.setSelected(false);
				jCheckBoxMenuItem18.setSelected(false);
				break;
            
            /*
			case GraphPanel.RTN_PLOT:
				jCheckBoxMenuItem11.setSelected(false);
				jCheckBoxMenuItem19.setSelected(false);
				break;
            
            case GraphPanel.RATIO_TUPLES_PLOT:
                jCheckBoxMenuItem20.setSelected(false);
                jCheckBoxMenuItem22.setSelected(false);
                break;
                
            case GraphPanel.EXTERNAL_INPUT_PLOT:
                jCheckBoxMenuItem21.setSelected(false);
                jCheckBoxMenuItem23.setSelected(false);
                break;
            */
                
            case GraphPanel.ALPHA_PLOT:
                jCheckBoxMenuItem24.setSelected(false);
                jCheckBoxMenuItem25.setSelected(false);
                break;
		}
		
		// This does not work...
		//jPanel9.remove(g);
		// So:
		Component[] l = jPanel9.getComponents();
		ArrayList<Integer> graph_order = new ArrayList<Integer>();
		for (int i = 0; i < l.length; i++) {
			
			if (l[i] instanceof GraphPanel)
				if (g.getGraphType() == ((GraphPanel)l[i]).getGraphType())
					jPanel9.remove(i);
				else
					graph_order.add(((GraphPanel)l[i]).getGraphType());
		
		}
		
		graph_visible--;
		adjustGraphLayout();
		g.setVisible(false);
		Main.setGraphOrder(graph_order);
		
	}
	
	private void adjustGraphLayout() {
		
		if (editor_visible) {
			
			jPanel9.setLayout(new BoxLayout(jPanel9, BoxLayout.Y_AXIS));
			jPanel9.revalidate();
			return;
			
		}
		
		if (graph_visible == 4) {
			if (fake == null) fake = new JPanel();
			jPanel9.add(fake);
		} else if (graph_visible == 7) {
			if (fake == null) fake = new JPanel();
			if (fake2 == null) fake2 = new JPanel();
			jPanel9.add(fake);
			jPanel9.add(fake2);
		} else {
			if (fake != null) jPanel9.remove(fake);
			if (fake2 != null) jPanel9.remove(fake2);
			fake = null;
			fake2 = null;
		}
		
		if (graph_visible <= 3)
			jPanel9.setLayout(new java.awt.GridLayout(1, 3));
		else if (graph_visible <= 6)
			jPanel9.setLayout(new java.awt.GridLayout(2, 3));
		else if (graph_visible <= 9)
			jPanel9.setLayout(new java.awt.GridLayout(3, 3));
		
		jPanel9.revalidate();
		
	}
	
	
	private boolean isCtagsInstalled() {
	
		ProcessBuilder pb = new ProcessBuilder(Main.getCtagsPath(), "--version");
		try {
			
			Process p = pb.start();
			p.waitFor();
			int exit = p.exitValue();
			if (exit == 0) return true;
			
		} catch (IOException ex) {
			System.out.println("Fail to start a process [ctags installed test][1]");
		} catch (IllegalThreadStateException i) {
			System.out.println("Fail to start a process [ctags installed test][2]");
		} catch (InterruptedException ex) {
			System.out.println("Fail to start a process [ctags installed test][3]");
		}
		
		return false;
	
	}
	
	private void showTextEditor(boolean show) {
		
		if(show) {
			
			if (!editor_visible) {
				
				//System.out.println("Show editor");
				Main.storeEditorVisible(true);
				jCheckBoxMenuItem1.setSelected(true);
				jToggleButton1.setSelected(true);
				jSplitPane4.setRightComponent(jPanel11);
				editor_visible = true;
				adjustGraphLayout();
				
				SwingUtilities.invokeLater(new Runnable() {
			
					@Override
					public void run() { 

						if (!jLabel7.getText().equals("")) {
							System.out.println("Function selected " + jLabel7.getText());
							loadFunctionInTextEditor(jLabel7.getText());
						}

					}
				});
			
			}
			
			
		} else {
		
			if (editor_visible) {
				
				//System.out.println("Hide editor");
				Main.storeEditorVisible(false);
				jCheckBoxMenuItem1.setSelected(false);
				jToggleButton1.setSelected(false);
				jSplitPane4.setRightComponent(null);
				editor_visible = false;
				adjustGraphLayout();
			
			}
			
		}
		
	}
	
	private void createTextEditor() {
		
		if (textArea != null) return;
		
		textArea = new RSyntaxTextArea(10, 10);
		textArea.setSyntaxEditingStyle(SyntaxConstants.SYNTAX_STYLE_CPLUSPLUS);
		//textArea.setSyntaxEditingStyle(SyntaxConstants.SYNTAX_STYLE_C);
		textArea.setCodeFoldingEnabled(true);
		textArea.setAntiAliasingEnabled(true);
		textArea.setEditable(false);
		
		JPopupMenu popup = textArea.getPopupMenu();
		popup.addSeparator();
		ActionEditor a = new ActionEditor();
		a.setMainWindow(this);
		popup.add(new JMenuItem(a));
		
		RTextScrollPane sp = new RTextScrollPane(textArea);
		sp.setFoldIndicatorEnabled(true);
		//Gutter gutter = sp.getGutter();
		//gutter.setBookmarkingEnabled(true);
		//gutter.setBookmarkIcon(new ImageIcon(getClass().getResource("/aprofplot/gui/resources/bookmark.png")));
		jPanel11.add(sp);
		
		/*
		SwingUtilities.invokeLater(new Runnable() {
			
			@Override
			public void run() { 
				textArea.setCaretPosition(textArea.getText().length() / 2);
			}
		});
		*/	  
	}

	private String cleanCPPSignature(String sig) {
	
		int index = sig.indexOf("(");
		if (index >= 0) sig = sig.substring(0, index);
		
		index = sig.indexOf("<");
		while (index >= 0) {
			
			int index2 = sig.indexOf(">", index);
			if (index2 < 0) { // fail :( 
				System.out.println("I need to clean function name " + sig +
										" but I failed... BUG");
				break;
			} 
			String sig_a = sig.substring(0, index);
			String sig_b = sig.substring(index2 + 1);
			sig = sig_a + sig_b;
			
			index = sig.indexOf("<");
			
		}
		
		index = sig.lastIndexOf(" ");
		if (index >= 0) sig = sig.substring(index + 1);
	
		//System.out.println(sig);
		
		return sig;
	} 
	
	public void loadFunctionInTextEditor(String name) {
		
		if (sym == null) return;
		if (!editor_visible) return;
		
		name = cleanCPPSignature(name);
		
		loading = true;
		Symbol s = sym.get(name);
		
		if (s == null) {
			
			//System.out.println("Function " + name + " was not found in the symbol table");
			
			try {
				/*
				final String error = "Source code of this function not found\n";
				textArea.read(new StringReader(error + "\n"), null);
				if (highlight_line != null) textArea.removeLineHighlight(highlight_line);
				highlight_line = textArea.addLineHighlight(0, Color.RED);
				*/
				final JFrame m = this;
				SwingUtilities.invokeLater(new Runnable() {
			
					@Override
					public void run() { 
						
						javax.swing.JOptionPane.showMessageDialog(m, "Source code of the function not found");
						//textArea.setCaretPosition(error.length());
						loading = false;
					}
				});
				
			} catch (Exception ex) {
				//
			}
			/*
			jComboBox1.setSelectedIndex(-1);
			jComboBox1.repaint();
			*/
			return;
		
		}
		
		Iterator i = files.iterator();
		int k = 0;
		while (i.hasNext()) {
			
			String file = (String) i.next();
			if (file.equals(s.getFile())) {
				break;
			}
			k++;
		}
		final int selected = k;
		//System.out.println("K is " + k);
		
		File f = new File(s.getFile());
		int count = s.getLine() - 1;
		int offset = 0;
		try {
			
			BufferedReader r = new BufferedReader(new FileReader(f));
			textArea.read(r, null);
			r.close();
			
			// calculate offset
			r = new BufferedReader(new FileReader(f));
			String line = null;
			
			while(count > 0 && (line = r.readLine()) != null) {
				
				offset += line.length() + 1;
				count--;
				
			}
			
			r.close();
			
		} catch (Exception ex) {
			//System.out.println(ex);
		}
		
		final int f_offset = offset;
		try {
			
			if (highlight_line != null) textArea.removeLineHighlight(highlight_line);
			highlight_line = textArea.addLineHighlight(s.getLine() - 1, Color.ORANGE);
		
		} catch (BadLocationException ex) {
			//
		}
		
		SwingUtilities.invokeLater(new Runnable() {
			
			@Override
			public void run() { 
				textArea.setCaretPosition(f_offset);
				jComboBox1.setSelectedIndex(selected);
				jComboBox1.repaint();
				loading = false;
			}
		});
	
	}
	
    public boolean isDisplayCumulativeTotalCost() {
        
        if (Main.getDisplayTotalCost() == Main.COST_CUMULATIVE) return true;        
        return false;
    
    }
    
    public boolean isChartCumulativeCost() {
        
        if (Main.getChartCost() == Main.COST_CUMULATIVE) return true;        
        return false;
    
    }
    
    public void refreshRoutine() {
        //System.out.println("Refreshing...");
        loadRoutine(this.rtn_info);
    }
    
    public boolean hasDistinctRms() {
        
        if (report != null && report.hasDistinctRms())
            return true;
        
        return false;
    }
    
    public boolean hasRvmsStats() {
        
        if (report != null && report.hasInputStats())
            return true;
        
        return false;
    }
    
	// For now we decide to disable context tree panel 
	/*
	private void expandContextTree() {
		for (int i = 0; i < jTree1.getRowCount(); i++) {
			jTree1.expandRow(i);
		}
	}

	private void addBranchToTree(DefaultMutableTreeNode root, ArrayList<RoutineContext> branch) {
		if (root.getChildCount() == 0) {
			DefaultMutableTreeNode currentNode = root;
			for (int i = branch.size() - 1; i >= 0; i--) {
				DefaultMutableTreeNode newNode = new DefaultMutableTreeNode(branch.get(i));
				currentNode.add(newNode);
				currentNode = newNode;
			}
		}
		else {
			DefaultMutableTreeNode currentNode = root;
			int i = branch.size() - 1;
			for (; i >= 0; i--) {
				boolean pathFound = false;
				for (int j = 0; j < currentNode.getChildCount(); j++) {
					DefaultMutableTreeNode child = (DefaultMutableTreeNode)currentNode.getChildAt(j);
					if (child.getUserObject().equals(branch.get(i))) {
						currentNode = child;
						pathFound = true;
						break;
					}
				}
				if (!pathFound) break;
			}
			for (; i >= 0; i--) {
				DefaultMutableTreeNode newNode = new DefaultMutableTreeNode(branch.get(i));
				currentNode.add(newNode);
				currentNode = newNode;
			}
		}
	}

	private void updateContextTree(Routine rtn) {
		DefaultTreeModel treeModel = (DefaultTreeModel)jTree1.getModel();
		if (rtn instanceof ContextualizedRoutineInfo){
			DefaultMutableTreeNode root = new DefaultMutableTreeNode("context trees:");
			ContextualizedRoutineInfo urtn = (ContextualizedRoutineInfo)rtn;
			for (int i = 0; i < urtn.getContextCount(); i++) {
				RoutineContext crtn = urtn.getContexts().get(i);
				ArrayList<RoutineContext> branch = new ArrayList<RoutineContext>();
				while (crtn != null) {
					branch.add(crtn);
					crtn = crtn.getParent();
				}
				addBranchToTree(root, branch);
			}
			treeModel.setRoot(root);
			expandContextTree();
		} else treeModel.setRoot(null);
	}
	*/

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton10;
    private javax.swing.JButton jButton11;
    private javax.swing.JButton jButton12;
    private javax.swing.JButton jButton2;
    private javax.swing.JButton jButton3;
    private javax.swing.JButton jButton4;
    private javax.swing.JButton jButton5;
    private javax.swing.JButton jButton6;
    private javax.swing.JButton jButton7;
    private javax.swing.JButton jButton8;
    private javax.swing.JButton jButton9;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem1;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem10;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem12;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem13;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem14;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem15;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem16;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem17;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem18;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem24;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem25;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem4;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem5;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem6;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem7;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem8;
    private javax.swing.JCheckBoxMenuItem jCheckBoxMenuItem9;
    private javax.swing.JComboBox<String> jComboBox1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JList jList1;
    private javax.swing.JMenu jMenu1;
    private javax.swing.JMenu jMenu2;
    private javax.swing.JMenu jMenu3;
    private javax.swing.JMenu jMenu4;
    private javax.swing.JMenu jMenu5;
    private javax.swing.JMenu jMenu6;
    private javax.swing.JMenuBar jMenuBar1;
    private javax.swing.JMenuItem jMenuItem1;
    private javax.swing.JMenuItem jMenuItem11;
    private javax.swing.JMenuItem jMenuItem12;
    private javax.swing.JMenuItem jMenuItem13;
    private javax.swing.JMenuItem jMenuItem14;
    private javax.swing.JMenuItem jMenuItem15;
    private javax.swing.JMenuItem jMenuItem16;
    private javax.swing.JMenuItem jMenuItem17;
    private javax.swing.JMenuItem jMenuItem18;
    private javax.swing.JMenuItem jMenuItem19;
    private javax.swing.JMenuItem jMenuItem2;
    private javax.swing.JMenuItem jMenuItem20;
    private javax.swing.JMenuItem jMenuItem21;
    private javax.swing.JMenuItem jMenuItem3;
    private javax.swing.JMenuItem jMenuItem4;
    private javax.swing.JMenuItem jMenuItem5;
    private javax.swing.JMenuItem jMenuItem6;
    private javax.swing.JMenuItem jMenuItem7;
    private javax.swing.JMenuItem jMenuItem8;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel11;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JPanel jPanel8;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JPopupMenu jPopupMenu1;
    private javax.swing.JProgressBar jProgressBar1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JScrollPane jScrollPane5;
    private javax.swing.JScrollPane jScrollPane6;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JToolBar.Separator jSeparator10;
    private javax.swing.JToolBar.Separator jSeparator11;
    private javax.swing.JToolBar.Separator jSeparator2;
    private javax.swing.JToolBar.Separator jSeparator3;
    private javax.swing.JSeparator jSeparator4;
    private javax.swing.JToolBar.Separator jSeparator5;
    private javax.swing.JToolBar.Separator jSeparator6;
    private javax.swing.JToolBar.Separator jSeparator7;
    private javax.swing.JToolBar.Separator jSeparator8;
    private javax.swing.JToolBar.Separator jSeparator9;
    private javax.swing.JSplitPane jSplitPane1;
    private javax.swing.JSplitPane jSplitPane2;
    private javax.swing.JSplitPane jSplitPane3;
    private javax.swing.JSplitPane jSplitPane4;
    private javax.swing.JSplitPane jSplitPane5;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JTable jTable1;
    private javax.swing.JTable jTable2;
    private javax.swing.JTable jTable3;
    private javax.swing.JTextField jTextField1;
    private javax.swing.JTextField jTextField2;
    private javax.swing.JToggleButton jToggleButton1;
    private javax.swing.JToggleButton jToggleButton10;
    private javax.swing.JToggleButton jToggleButton2;
    private javax.swing.JToggleButton jToggleButton4;
    private javax.swing.JToolBar jToolBar1;
    private javax.swing.JToolBar jToolBar2;
    private javax.swing.JTree jTree1;
    private javax.swing.JMenuItem recentMenuItem1;
    private javax.swing.JMenuItem recentMenuItem2;
    private javax.swing.JMenuItem recentMenuItem3;
    private javax.swing.JMenuItem recentMenuItem4;
    private javax.swing.JMenuItem recentMenuItem5;
    private javax.swing.JMenuItem recentMenuItem6;
    // End of variables declaration//GEN-END:variables
	
	// Graphs
	private GraphPanel CostGraphPanel, ratioGraphPanel, 
						freqGraphPanel, MMMGraphPanel,
						TotalCostGraphPanel, VarGraphPanel,
						RtnGraphPanel, AmortizedGraphPanel,
                        RatioTuplesGraphPanel, ExternalInputGraphPanel,
                        AlphaGraphPanel;
    
	private TableRowSorter<TableModel> routines_table_sorter = null;
	private List<RowSorter.SortKey> routines_sort = null;
    
    private TableRowSorter<TableModel> rms_table_sorter = null;	
    private List<RowSorter.SortKey> rms_sort = null;
    
    private TableRowSorter<TableModel> contexts_table_sorter = null;
    private List<javax.swing.RowSorter.SortKey> contexts_sort = null;
   
	private RSyntaxTextArea textArea = null;
	private Object highlight_line = null;
	
    private int stack_trace_divider = -1;
    private int contexts_divider = -1;
    private String[] contexts_filter_criteria = null;
	private String[] routines_filter_criteria = null;
	private String[] rms_filter_criteria = new String[4];
	private AprofReport report = null;
	private boolean linked_plots = true;
	private JMenuItem[] recentMenuItems = new JMenuItem[6];

}
